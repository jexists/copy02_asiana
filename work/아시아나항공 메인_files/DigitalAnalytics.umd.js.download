!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.DigitalAnalytics=e()}(this,function(){"use strict";var t=function(){function t(){}return t.getDay=function(e){return t.WEEK_DAY[e]},t.WEEK_DAY=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t}(),e=function(){function e(){}return e.getDigitalDate=function(t){if(!t)return null;var e=t.split("-");return new Date(Date.parse(e[1]+"/"+e[2]+"/"+e[0]+" 00:00:00 UTC"))},e.getDigitalDateTime=function(t){return t?this.getDigitalDate(t.substring(0,10)):null},e.getTransactionDate=function(t){var e=(t.getMonth()<9?"0":"")+(t.getMonth()+1),r=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+""+e+r},e.getShortDayOfWeek=function(r){var n=e.getDigitalDateTime(r);return t.getDay(n.getDay())},e}(),r=function(){function t(){}return t.isAppEmbedded=function(){return!(!window.communityApp&&!window.nativeAppCommunication)},t.isFileProtocol=function(){return"file:"===window.location.protocol},t.isExternalAppWindow=function(e){return!(!t.isAppEmbedded()||0!==e.lastIndexOf("/amop/",0)&&0!==e.lastIndexOf("/merciapp/",0))},t.roundAmount=function(t){return Math.round(100*t)/100},t.extend=function(e,r){for(var n in r)if(Array.isArray(r[n])){var i=e[n]?e[n]:new Array;e[n]=t.extend(i,r[n])}else if("object"==typeof r[n]){var a=e[n]?e[n]:new Object;e[n]=t.extend(a,r[n])}else e[n]!==r[n]&&(e[n]=r[n]);return e},t.getJsonProperty=function(e,r){return this.getJsonPropertyWithDefaultValue(e,t.NOT_SET_DATA,r)},t.getJsonObject=function(t,e){return this.getJsonPropertyWithDefaultValue(t,null,e)},t.getJsonAmount=function(t,e){return this.getJsonPropertyWithDefaultValue(t,0,e)},t.getJsonPropertyWithDefaultValue=function(t,e,r){return t.split(".").reduce(function(t,r){return t&&t[r]?t[r]:e},r)},t.NOT_SET_DATA="NOT_SET",t.flatten=function(t){var e={},r=function(t,n){if(Object(t)!==t)e[n]=t;else if(Array.isArray(t)){for(var i=t.length,a=0;a<i;a++)r(t[a],n+"["+a+"]");0===i&&(e[n]=[])}else{var o=!0;for(var s in t)o=!1,r(t[s],n?n+"."+s:s);o&&n&&(e[n]={})}};return r(t,""),e},t}(),n=function(){function t(){}return t.isFromGroup=function(t,e){return null!==t.match(new RegExp(e+"(\\?.*)?$"))},t.isFarePage=function(t){return"FARE"===t},t.isredirectionPageSPBF=function(t,e){return"REDI"===t&&"ibe-spbf"===e.toLowerCase()},t.AVAILABILITY_GROUP="(OCUP|OWDA|OWDO|OWCO|FFPR|FFCO|ODUP|FFPC|SDAI|FDFF|FDFFCPX|FPC|FPOW|AVAI|FPRM)",t.FLIGHT_GROUP="(FFCR|FDCS|FDCSCPX|ITCL|FDCT|FFCC|OCCL|OCUP|OWDA|OWDO|OWCO|OWRO|FARR|FFPR|FFCO|ODUP|FFPC|SDAI|FDFF|FDFFCPX|FPC|FPOW|AVAI|FPRM|MCAL-OWD|AVAIL-OUT-OWD|AVAIL-IN-OWD|LCAL-OWD|SRCH-ITIN|MCAL-ITIN|LCAL-ITIN|AVAIL-ITIN|SRCH-SD|AVAIL-OUT-SD|AVAIL-IN-SD|CAL-OWC|CAL-OWC|AVAIL-OUT-OWC|AVAIL-IN-OWC)",t.PAX_GROUP="(ALPI|APIM|ALPI-OWD|ALPI-ITIN|ALPI-SD|ALPI-OWC)",t.AAS_GROUP="(AAS|AAAS-ITIN|AAAS-SD|AAAS-OWC|AAAS-OWD)",t.PURC_GROUP="(PURC|PURC-OWD|PURC-ITIN|PURC-SD|PURC-OWC|MPURC)",t.CONFIRMATION_GROUP="(CONF|MCONF|ATCRC|RCONF|CONF-OWD|CONF-ITIN|CONF-SD|CONF-OWC|ATC-CONF-OWD|ATC-CONF-SD|ATC-CONF-ITIN)",t.RETRIEVE_GROUP="(RTPL|TLIST|RTPL-OWC|RTPL-SD|RTPL-ITIN|RTPL-OWD)",t.ATC_GROUP="(ATCR|ATCRC|RADVS|RSDAI|RFPOW|RFARE|RPURC|RCONF|ATC-SRCH-OWD|ATC-MCAL-OWD|ATC-OUT-AVAIL-OWD|ATC-IN-AVAIL-OWD|ATC-FARE-OWD|ATC-PURC-OWD|ATC-CONF-OWD|ATC-SRCH-SD|ATC-OUT-AVAIL-SD|ATC-IN-AVAIL-SD|ATC-FARE-SD|ATC-PURC-SD|ATC-CONF-SD|ATC-SRCH-ITIN|ATC-MCAL-ITIN|ATC-OUT-AVAIL-ITIN|ATC-IN-AVAIL-ITIN|ATC-FARE-ITIN|ATC-PURC-ITIN|ATC-CONF-ITIN)",t.SSCI_GROUP="(identification|journeylist|dangerousgoods|paxlist|checkin|hajj|transferjourneylist|rebookingoverview|voluntarydeniedboarding|overview|fqtv|seatmap|exitseat|apis|contactdetails|security|payment|documentsdelivery|thanks|error|genericerror|discrepancies|checkout|offloadconfirmation)",t.SERVICING_GROUP="(MALPI|MAPIM|MAPIS|MCONF|MDFSR|MINS|MPURC|MVERI|MALPI-OWD|MAPIS-OWD|SERV-PURC|SERV-AAAS|SERV-CONF|SERV-AAAS-OWD|SERV-AAAS-OWC|SERV-PURC-OWD|MALPI-ITIN|MAPIS-ITIN|SERV-AAAS-ITIN|SERV-PURC-ITIN|MALPI-SD|MAPIS-SD|SERV-AAAS-SD|SERV-PURC-SD|MALPI-OWC|MAPIS-OWC)",t}(),i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(t){function e(t){((t=t||"")instanceof URLSearchParams||t instanceof e)&&(t=t.toString()),this[h]=a(t)}function r(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,function(t){return e[t]})}function n(t){return t.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,function(t){return decodeURIComponent(t)})}function i(e){var r={next:function(){var t=e.shift();return{done:t===undefined,value:t}}};return l&&(r[t.Symbol.iterator]=function(){return r}),r}function a(t){var e={};if("object"==typeof t)if(s(t))for(var r=0;r<t.length;r++){var i=t[r];if(!s(i)||2!==i.length)throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements");o(e,i[0],i[1])}else for(var a in t)t.hasOwnProperty(a)&&o(e,a,t[a]);else{0===t.indexOf("?")&&(t=t.slice(1));for(var c=t.split("&"),g=0;g<c.length;g++){var u=c[g],h=u.indexOf("=");-1<h?o(e,n(u.slice(0,h)),n(u.slice(h+1))):u&&o(e,n(u),"")}}return e}function o(t,e,r){var n="string"==typeof r?r:null!==r&&r!==undefined&&"function"==typeof r.toString?r.toString():JSON.stringify(r);e in t?t[e].push(n):t[e]=[n]}function s(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}var c=t.URLSearchParams&&t.URLSearchParams.prototype.get?t.URLSearchParams:null,g=c&&"a=1"===new c({a:1}).toString(),u=c&&"+"===new c("s=%2B").get("s"),h="__URLSearchParams__",d=!c||function(){var t=new c;return t.append("s"," &"),"s=+%26"===t.toString()}(),p=e.prototype,l=!(!t.Symbol||!t.Symbol.iterator);if(!(c&&g&&u&&d)){p.append=function(t,e){o(this[h],t,e)},p["delete"]=function(t){delete this[h][t]},p.get=function(t){var e=this[h];return t in e?e[t][0]:null},p.getAll=function(t){var e=this[h];return t in e?e[t].slice(0):[]},p.has=function(t){return t in this[h]},p.set=function(t,e){this[h][t]=[""+e]},p.toString=function(){var t,e,n,i,a=this[h],o=[];for(e in a)for(n=r(e),t=0,i=a[e];t<i.length;t++)o.push(n+"="+r(i[t]));return o.join("&")};var f=!!u&&c&&!g&&t.Proxy;Object.defineProperty(t,"URLSearchParams",{value:f?new Proxy(c,{construct:function(t,r){return new t(new e(r[0]).toString())}}):e});var y=t.URLSearchParams.prototype;y.polyfill=!0,y.forEach=y.forEach||function(t,e){var r=a(this.toString());Object.getOwnPropertyNames(r).forEach(function(n){r[n].forEach(function(r){t.call(e,r,n,this)},this)},this)},y.sort=y.sort||function(){var t,e,r,n=a(this.toString()),i=[];for(t in n)i.push(t);for(i.sort(),e=0;e<i.length;e++)this["delete"](i[e]);for(e=0;e<i.length;e++){var o=i[e],s=n[o];for(r=0;r<s.length;r++)this.append(o,s[r])}},y.keys=y.keys||function(){var t=[];return this.forEach(function(e,r){t.push(r)}),i(t)},y.values=y.values||function(){var t=[];return this.forEach(function(e){t.push(e)}),i(t)},y.entries=y.entries||function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),i(t)},l&&(y[t.Symbol.iterator]=y[t.Symbol.iterator]||y.entries)}}(void 0!==i?i:"undefined"!=typeof window?window:i);var a,o=function(){function i(t){this._data=t,this.libVersion="2.4.6",this.flightProduct=this.computeFlightProduct(),this._touchpointInfo=this.getJsonObject("digitalTouchpoint.touchpointInfo"),this._transactionTotal=this.getJsonObject("transaction.total")}return i.getEventAttributeValue=function(t,e){if(t.attributes)for(var r=0,n=t.attributes;r<n.length;r++){var i=n[r];if(i.key===e&&i.value)return String(i.value.value)}return null},i.prototype.getPagePath=function(){var t=window.document.location.pathname.replace(/;(.*)/g,"");if(t.indexOf("/Bundle/Application/")>-1){var e=t.split("/"),r=e.indexOf("Application")+1;e.splice(r,1),t=e.join("/")}return"not_set"===this.getJsonProperty("page.pageInfo.pageID").toLowerCase()&&(t+="/"+this.getFlow()),("not_set"===this.getFlow().toLowerCase()&&"not_set"!==this.getJsonProperty("page.pageInfo.pageID").toLowerCase()||"not_set"!==this.getFlow().toLowerCase()&&"not_set"!==this.getJsonProperty("page.pageInfo.pageID").toLowerCase())&&(t+="/"+this.getFlow()+"/"+this.getJsonProperty("page.pageInfo.pageID")),n.isFromGroup(this.getPageID(),n.FLIGHT_GROUP)?t+this.getSiteSearch():t},i.prototype.getSiteSearch=function(){var t=this.locationSearch();return(""===window.document.location.search?"?":""!==t?"?"+this.locationSearch()+"&":"?")+"cp="+this.getProductName()+"&c=IBE-"+this.getFlow()},i.prototype.locationSearch=function(){for(var t=new URLSearchParams(window.location.search),e=new URLSearchParams,r=0,n=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","dclid","clientId","_ga","__utma","__utmb","__utmc","__utmx","__utmz","__utmcsr","__utmccn","__utmcmd","__utmv","__utmk","adobe_mc","adobe_mc_sdid","hmsr","hmpl","hmcu","hmkw","hmci","pk_vid","pk_campaign","pk_kwd","pk_source","pk_medium","pk_content","__hsfp","__hssc","__hstc","_sp"];r<n.length;r++){var i=n[r];t.get(i)&&e.append(i,t.get(i))}return e.toString()},i.prototype.getPageStructure=function(t){return t+"/"+this.getMarket()+"/"+this.getLanguage()+"/"+this.getFlow()+"/"+this.getChannel()+"/"+this.getPageID()+"-"+this.getJsonProperty("site",this._touchpointInfo)+"-"+this.getJsonProperty("officeID",this._touchpointInfo)},i.prototype.getPageObject=function(){return this.getJsonObject("page")},i.prototype.getPageID=function(){return this.getJsonProperty("page.pageInfo.pageID")},i.prototype.getPageName=function(){return this.getJsonProperty("page.pageInfo.pageName")},i.prototype.getSessionId=function(){return this.getJsonProperty("sessionID",this._touchpointInfo)},i.prototype.getLibVersionWithSessionId=function(){return"ddlib.v."+this.libVersion+"/"+this.getSessionId()},i.prototype.getProfile=function(){return this.getUserID()?i.USER_LOGGED:i.USER_ANOM},i.prototype.getUserID=function(){return r.getJsonPropertyWithDefaultValue("user.0.profile.0.profileInfo.userID",undefined,this._data)},i.prototype.getTravelGroup=function(){if(Array.isArray(this._data.traveller)){for(var t={},e=0,r=this._data.traveller;e<r.length;e++){var n=r[e];t[n.passengerTypeCode]?t[n.passengerTypeCode]=t[n.passengerTypeCode]+1:t[n.passengerTypeCode]=1}var a="";for(var o in t)""!==a&&(a+="-"),a+=o+":"+t[o];return"total:"+this.getTravellers()+"-"+a}return i.NOT_SET_DATA},i.prototype.getTrip=function(){var t=this.getJourneyLength();return this.getTripType()+"-"+t},i.prototype.getLastSearch=function(t){return t.load(this.getSessionId()).lastSearch},i.prototype.getSearch=function(t){var e=this.getSearchInputFlightDetails(),r=e[0].flexibleDateValue>0?"YES":"NO",n=e[0].flexibleDateValue,i=this.getTripType(),a=0;window.eBaDataLayer&&window.eBaDataLayer.nb_farefamilies_displayed&&(a=window.eBaDataLayer.nb_farefamilies_displayed);var o=this.getAdvancedPurchase(),s="flight-"+r+":"+n+"-"+i+"-"+this.getSearchLocations().join("-")+"-"+this.getSearchDates().join("-")+"-"+a+"-"+o,c=t.load(this.getSessionId());return c.lastSearch=s,t.save(this.getSessionId(),c),s},i.prototype.getSearchLocations=function(){for(var t=this.getSearchInputFlightDetails(),e=this.getJsonProperty("0.departure.cityCode",t)?"cityCode":"locationCode",r=[],n=0;n<t.length;n++)r.push(this.getJsonProperty(n+".departure."+e,t)),this.getTripType()!==i.TRIP_TYPE_RETURN&&r.push(this.getJsonProperty(n+".arrival."+e,t));return r},i.prototype.getSearchDates=function(){for(var t=this.getSearchInputFlightDetails(),e=[],r=0;r<t.length;r++)e.push(t[r].departure.dateTime.split("-").join(""));return e},i.prototype.getPayment=function(){var t=[],e=this.getJsonObject("transaction.payment");if(e)for(var r=0,n=e;r<n.length;r++){var i=n[r];t.push(this.getJsonProperty("methodOfPayment",i)+"_"+this.getJsonProperty("paymentType",i))}return t.join("|")},i.prototype.getAward=function(){var t=this.getJsonAmount("miles.milesAmount",this._transactionTotal),e=this.getAwardRevenue();return t>0||e>0?"miles:"+t+"-cash_paid:"+this.getJsonAmount("totalPrice.currency",this._transactionTotal)+this.getJsonAmount("totalPrice.amount",this._transactionTotal)+"-miles_paid:"+this.getJsonAmount("miles.milesAmount",this._transactionTotal)+"-cash_paid_in_miles:"+e+"-minimum:"+i.NOT_SET_DATA:null},i.prototype.getAwardRevenue=function(){var t=this.getJsonAmount("miles.cashPaidInMiles.amount",this._transactionTotal);return 0===t?null:t},i.prototype.getTravellers=function(){return this.getJsonAmount("traveller.length")},i.prototype.getJourneyLength=function(){var t;if(this.flightProduct&&this.flightProduct.journeyLength)t=this.flightProduct.journeyLength;else{var r=this.getSearchInputFlightDetails();if(!r)return-1;if(r.length<2)return 0;var n=e.getDigitalDate(r[0].departure.dateTime).getTime(),i=e.getDigitalDate(r[r.length-1].departure.dateTime).getTime();t=Math.floor((i-n)/864e5)}return t},i.prototype.getAdvancedPurchase=function(){var t=this.getSearchInputFlightDetails(),r=this.getSearchInput();if(t&&r){var n=new Date(r.searchInputInfo.dateTime).getTime(),i=e.getDigitalDate(t[0].departure.dateTime).getTime();return Math.floor((i-n)/864e5)}return-1},i.prototype.getRetrieveMetric=function(){return 1},i.prototype.getAdvancedPurchaseDayBucket=function(){var t=this.getAdvancedPurchase();if(t<0)return"NA";if(t<=1)return t+" day";for(var e=2,r=0,n=[3,7,14,21,28,35,42,60,90,120,150,180];r<n.length;r++){var i=n[r];if(t<=i)return e+" to "+i+" days";e=i+1}return"more than 180 days"},i.prototype.getDigitalTouchpointObject=function(){return this.getJsonObject("digitalTouchpoint")},i.prototype.getChannel=function(){var t={eretail:"DX",dx:"DX",merci:"Merci",mobile:"Merci"},e=this.getJsonProperty("digitalTouchpoint.category.primaryCategory"),n=e.toLowerCase(),i=!1;"mobileapp"===e.toLowerCase()?(n=this.getJsonProperty("digitalTouchpoint.category.subCategory").toLowerCase(),i=!0):r.isAppEmbedded()&&(i=!0);var a=t[n]?t[n]:e;return i?"IBE-"+a+"MobileAPP":"IBE-"+a},i.prototype.getFlow=function(){if("RTPL"===this.getPageID())return i.FLOW_RETRIEVE;var t=this.getJsonProperty("page.category.primaryCategory").toLowerCase();return"booking"===t?i.FLOW_REVENUE:"rebooking"===t||"refund"===t?i.FLOW_ATC:t||i.NOT_SET_DATA},i.prototype.getMarket=function(){return this.getJsonProperty("market",this._touchpointInfo)},i.prototype.getLanguage=function(){return this.getJsonProperty("language",this._touchpointInfo)},i.prototype.getBookingFlow=function(){return this.getJsonProperty("bookingFlow",this._touchpointInfo)},i.prototype.getMarketLanguage=function(){return this.getMarket()+"-"+this.getLanguage()},i.prototype.hasProduct=function(){return!!Array.isArray(this._data.product)},i.prototype.getProductName=function(){var t=this.getSearchInputFlightDetails();if(t&&t[0]){t[0].departure.cityCode;var e=this.getTripType();return this.getSearchLocations().reduce(function(t,e,r){return t+(r%2==0?"|":"_")+e})+"-"+e}return i.NOT_SET_DATA},i.prototype.getCurrency=function(){return window.eBaDataLayer&&window.eBaDataLayer.currency?window.eBaDataLayer.currency:this.getJsonProperty("bound.0.price.totalPrice.currency",this.flightProduct)},i.prototype.getFlightCategory=function(t,e){try{return this.getGenericProductCategory(t,e,i.FLIGHT_TYPE)}catch(r){return i.NOT_SET_DATA}},i.prototype.getFlightVariant=function(t){return this.computeFlightVariant(this.getBoundRoute(t),this.getBoundType(t))},i.prototype.getItineraryVariant=function(){return this.computeFlightVariant(this.getProductRoute(),i.ITINERARY)},i.prototype.computeFlightVariant=function(t,e){return i.FLIGHT_TYPE+"/"+t+"/"+e+"/ / "},i.prototype.getFlightId=function(t){return this.computeFlightId(this.getBoundRoute(t),this.getBoundFlights(t),this.getBoundType(t))},i.prototype.getItineraryId=function(){return this.computeFlightId(this.getProductRoute(),this.getProductFlights(),i.ITINERARY)},i.prototype.computeFlightId=function(t,e,r){return this.getProductName()+"/"+i.FLIGHT_TYPE+"/"+i.FLIGHT_TYPE+"/ /"+t+"/"+e+"/"+r+"/ / "},i.prototype.getFlightPricePerPax=function(t){var e=this.getJsonAmount("bound."+t+".price.priceBreakdown.baseFarePrice.amount",this.flightProduct),n=r.getJsonPropertyWithDefaultValue("utils.context.AppContext",null,window.plnextv2);return n&&n.getPageData()&&this.getJsonAmount("business.Price.baseFare.amount",n.getPageData())>0&&(e=n.getPageData().business.Price.baseFare.amount/this.getBoundCount()),r.roundAmount(e/this.getFlightQuantity())},i.prototype.getItineraryPricePerPax=function(){return this.getFlightPricePerPax(0)},i.prototype.getFlightTotalPrice=function(t){return this.getJsonAmount("bound."+t+".price.totalPrice.amount",this.flightProduct)},i.prototype.getFlightQuantity=function(){return this._data.traveller?this._data.traveller.length:0},i.prototype.getFlightDepartureLocation=function(t){var e=this.getJsonObject("bound."+t+".segment.0.departure",this.flightProduct);return this.getFullLocation(e)},i.prototype.getFlightArrivalLocation=function(t){var e=t;null!==t&&void 0!==t||(e=this.getBoundCount()-1,this.getTripType()===i.TRIP_TYPE_RETURN&&(e=0));var r=this.getJsonObject("bound."+e+".segment",this.flightProduct);if(r){var n=this.getJsonObject(r.length-1+".arrival",r);return this.getFullLocation(n)}return i.NOT_SET_DATA},i.prototype.getPassengersList=function(){if(!this._data.traveller)return i.NOT_SET_DATA;for(var t=[],e=0,r=this._data.traveller;e<r.length;e++){var n=r[e];if("INF"!==n.passengerTypeCode){var a=this.getPassengerFrequentFlyer(n.travellerID);t.push(a)}}return t.join("-")},i.prototype.getFlightPriceCategories=function(t,e){return void 0===e&&(e=1),this.computeFlightPriceCategories(this.flightProduct.bound[t].upsell,e)},i.prototype.getItineraryPriceCategories=function(t){return void 0===t&&(t=1),this.computeFlightPriceCategories(this.flightProduct.bound[0].upsell,t)},i.prototype.computeFlightPriceCategories=function(t,e){if(!t||!t.otherFareFamily)return null;for(var n=[],i=0,a=t.otherFareFamily;i<a.length;i++){var o=a[i];if(o.price){var s=this.getJsonProperty("fareFamilyName",o),c=o.price,g=o.fareFamilyCode+"_"+s+"_"+r.roundAmount(c*e);n.push(g)}}return n.join("|")},i.prototype.getFlightUpsell=function(t){var e=this.getJsonObject("bound."+t+".upsell.otherFareFamily",this.flightProduct);return this.computeFlightUpsell(this.getFlightTotalPrice(t),e)},i.prototype.getItineraryUpsell=function(){var t=this.getJsonObject("bound.0.upsell.otherFareFamily",this.flightProduct);return this.computeFlightUpsell(this.getFlightTotalPrice(0),t)},i.prototype.computeFlightUpsell=function(t,e){var r;if(e)for(var n=0,i=e;n<i.length;n++){var a=i[n];(r===undefined||r>a.price)&&(r=a.price)}var o=0;return t&&r&&(o=Math.round(1e4*(t-r)/r)),o},i.prototype.getAncillaryServiceId=function(t){var r,n=this.getAncillaryService(t),a=n.boundID,o=" ",s=" ";a&&(r=this.getBoundIndex(a),o=this.getBoundType(r),s=this.getBoundRoute(r));var c=n.segmentID,g=this.getSegment(a,c),u=n.categoryCode+"-"+n.serviceCode,h=i.TRIP,d=" ";if(g){h=i.SEGMENT;var p=e.getShortDayOfWeek(g.departure.dateTime);d=g.marketingAirlineCode+g.marketingFlightNumber+"_"+p}else a?(h=i.BOUND,d=this.getBoundFlights(r)):n.travellerID&&(h=i.TRAVELLER);return this.getProductName()+"/"+i.FLIGHT_TYPE+"/"+i.ANCILLARY_TYPE+"/"+h+"/"+s+"/"+d+"/"+o+"/"+u},i.prototype.getAncillaryServiceCategory=function(t,e){var r=this.getAncillaryService(t);if(r){var n=this.getBoundIndex(r.boundID);if(null!==n)return this.getGenericProductCategory(n,e,i.ANCILLARY_TYPE)}return i.NOT_SET_DATA},i.prototype.getAncillaryVariant=function(t){var e=this.getAncillaryService(t),r=e.segmentID,n=e.boundID,a=this.getBoundIndex(e.boundID),o=this.getSegment(n,r),s=null!=a?this.getBoundType(a):i.NOT_SET_DATA,c=i.NOT_SET_DATA;if(o)c=o.departure.airportCode+"_"+o.arrival.airportCode;else{var g=this.flightProduct;if(null!=a){var u=g.bound[a].segment;c=this.getAirportsList(u).join("_")}}return i.ANCILLARY_TYPE+"/"+c+"/"+s+"/"+e.categoryCode+"/"+e.serviceCode},i.prototype.getAncillaryServicePricePerPax=function(t){var e=this.getJsonAmount("price.totalPrice.amount",this.getAncillaryService(t));return r.roundAmount(e/this.getAncillaryServiceQuantity(t))},i.prototype.getAncillaryServiceQuantity=function(t){return this.getJsonAmount("quantity",this.getAncillaryService(t))},i.prototype.getAncillaryServiceDepartureLocation=function(t){var e=this.getAncillaryService(t),r=e.segmentID,n=e.boundID,i=this.getSegment(n,r);if(i)return this.getFullLocation(this.getJsonObject("departure",i));var a=this.getBoundIndex(n);this.flightProduct;return this.getFullLocation(this.getJsonObject("bound."+a+".segment.0.departure",this.flightProduct))},i.prototype.getAncillaryServiceArrivalLocation=function(t){var e=this.getAncillaryService(t),r=e.segmentID,n=e.boundID,a=this.getSegment(n,r);if(a)return this.getFullLocation(this.getJsonObject("arrival",a));var o=this.getBoundIndex(n),s=this.getJsonObject("bound."+o+".segment",this.flightProduct);return s?this.getFullLocation(this.getJsonObject(s.length-1+".arrival",s)):i.NOT_SET_DATA},i.prototype.getInsuranceId=function(t){var e=this.getInsurance(t),r="INS-"+e.code,n=i.TRIP;return e.travellerID&&(n=i.TRAVELLER),this.getProductName()+"/"+i.FLIGHT_TYPE+"/"+i.INSURANCE_TYPE+"/"+n+"/ / / /"+r},i.prototype.getInsuranceCategory=function(t){return this.getRouteType(t)+"/-/-/-/"+i.INSURANCE_TYPE},i.prototype.getInsuranceVariant=function(t){var e="INS/"+this.getInsurance(t).code;return i.INSURANCE_TYPE+"/ / /"+e},i.prototype.getInsurancePrice=function(t){return this.getJsonAmount("price.amount",this.getInsurance(t))},i.prototype.getPriceProductId=function(t){return this.getProductName()+"/"+i.FLIGHT_TYPE+"/"+t+"/"+i.TRIP+"/ / / / "},i.prototype.getPriceProductcategory=function(t,e){return this.getRouteType(t)+"/-/-/-/"+e},i.prototype.getPriceProductVariant=function(t){return t+"/ / / / "},i.prototype.getPriceProductPrice=function(t){switch(t){case i.FUELSURCHARGE_TYPE:return this.getFuelSurchargePrice();case i.SERVICEFEES_TYPE:return this.getJsonAmount("priceBreakdown.serviceFee.amount",this._transactionTotal);case i.TAX_TYPE:return this.getTransactionTax();default:return null}},i.prototype.getFuelSurchargePrice=function(){return this.getJsonAmount("priceBreakdown.tax.fuelSurcharge.amount",this._transactionTotal)},i.prototype.getTransactionId=function(){var t=i.NOT_SET_DATA,r=this.getJsonObject("transaction.PNR.recLoc");return r!==i.NOT_SET_DATA&&(t=e.getTransactionDate(new Date(this.getJsonObject("transaction.PNR.creationDate")))),t+"_"+r},i.prototype.getTransactionRevenue=function(){return this.getJsonAmount("totalPrice.amount",this._transactionTotal)},i.prototype.getCartRevenue=function(){return this.getJsonAmount("cart.price.totalPrice.amount")},i.prototype.getTransactionTax=function(){return this.getJsonAmount("priceBreakdown.tax.totalTax.amount",this._transactionTotal)-this.getFuelSurchargePrice()},i.prototype.getImpressionData=function(t){var e=this,n=[],a=r.getJsonPropertyWithDefaultValue("utils.context.AppContext",null,window.plnextv2);if(a){var o=a.getPageData().business.Availability,s=this.getRouteType(t);if(o){var c=[];o.proposedBounds.forEach(function(t,e){for(var r=0,n=t.proposedFlightsGroup;r<n.length;r++){var i=n[r];c[e+"-"+i.proposedBoundId]=i}});var g=0;o.cube.bounds.forEach(function(t,r){var i=e.getBoundType(r,r+1);t.fareFamilyList.forEach(function(t,a){var u=o.fareFamilyList[a];for(var h in t.flights)if(t.flights.hasOwnProperty(h)&&"aria:parent"!==h){var d=t.flights[h].flight,p=c[r+"-"+d.flightId],l=u.ffCode+"-"+u.ffName,f=e.getDXFlightImpression(p.segments,s,i,g++,l);n.push(f)}})})}else{var u=a.getPageData().business.SDrivenAvails;if(u){var h=0;u.listAvailabilitySchedule.forEach(function(t,r){for(var a=0,o=t.listFlight;a<o.length;a++){var c=o[a],g=e.getBoundType(r,r+1),u=i.CABIN+i.NOT_SET_DATA;c.cabinList&&c.cabinList[0].code&&(u=i.CABIN+c.cabinList[0].code);var d=e.getDXFlightImpression(c.segments,s,g,h++,u);n.push(d)}})}}}return n},i.prototype.getSelectedFlight=function(t,e){var n=r.getJsonPropertyWithDefaultValue("utils.context.AppContext",null,window.plnextv2);if(n)for(var a=void 0,o=t.load(this.getSessionId()),s=n.getPageData().business.TripSummary.listItinerary.listItineraryElem,c=this.getRouteType(e),g=0;g<s.length;g++){var u=s[g];if(!u)return null;var h=this.getBoundType(g,g+1),d=i.NOT_SET_DATA+"-"+i.NOT_SET_DATA;u.fareFamily?d=u.fareFamily.ffCode+"-"+u.fareFamily.ffName:n.getPageData().business.Search.cabin&&(d=i.CABIN+n.getPageData().business.Search.cabin);var p=(a=this.getDXFlightImpression(u.listSegment,c,h,0,d)).id+a.category;if(o.selectedFlights[g]!==p)return o.selectedFlights[g]=p,t.save(this.getSessionId(),o),a}return null},i.prototype.getTripType=function(){var t=this.getSearchInputFlightDetails(),e="";if(Array.isArray(t)){e=t[0].tripType;for(var n=1;n<t.length;n++)if(t[n].tripType!==e)return i.TRIP_TYPE_COMPLEX}else{var a=r.getJsonPropertyWithDefaultValue("utils.context.AppContext",null,window.plnextv2);a&&a.getPageData()&&(e=r.getJsonPropertyWithDefaultValue("business.Search.tripType",null,a.getPageData()))}return"R"===e?i.TRIP_TYPE_RETURN:"O"===e?i.TRIP_TYPE_ONEWAY:"M"===e?i.TRIP_TYPE_COMPLEX:i.NOT_SET_DATA},i.prototype.getTripRouteHaul=function(){for(var t=0,e=0,r=this.flightProduct.bound;e<r.length;e++)for(var n=0,a=r[e].segment;n<a.length;n++){var o=a[n],s=new Date(o.departure.dateTime),c=new Date(o.arrival.dateTime).getTime()-s.getTime(),g=Math.ceil(c/6e4);if(g>299)return i.LONG_HAUL;g>t&&(t=g)}return t>179?i.MID_HAUL:i.SHORT_HAUL},i.prototype.getBoundCount=function(){return this.getJsonAmount("bound.length",this.flightProduct)},i.prototype.getAncillaryServicesIds=function(){for(var t=[],e=0,r=this._data.product;e<r.length;e++){var n=r[e];"AncillaryService"===n.category.primaryCategory&&t.push(parseInt(n.productInfo.productID,10))}return t},i.prototype.getInsuranceIds=function(){for(var t=[],e=0,r=this._data.product;e<r.length;e++){var n=r[e];"Insurance"===n.category.primaryCategory&&t.push(parseInt(n.productInfo.productID,10))}return t},i.prototype.isItineraryMode=function(){if(this.getTripType()!==i.TRIP_TYPE_ONEWAY){var t=this.getJsonObject("bound.0",this.flightProduct);if(t&&this.getJsonObject("price",t)&&null===this.getJsonObject("bound.1.price",this.flightProduct))return!0}return!1},i.prototype.getGenericProductCategory=function(t,r,n){var a,o,s=this.flightProduct,c=0,g="",u=i.NOT_SET_DATA,h=this.getRouteType(r);if(s){if(null===t){for(var d=0;d<this.getBoundCount();d++){c+=(p=s.bound[d]).segment.length-1}a=this.getJsonObject("bound.0",s),o=this.getJsonObject("bound.0.segment.0",s)}else{var p=s.bound[t];a=p,p.segment&&(o=this.getJsonObject("segment.0",p),c=p.segment.length-1)}o&&(u=e.getTransactionDate(e.getDigitalDateTime(this.getJsonObject("departure.dateTime",o)))),g=a.fareFamilyCode?this.getJsonProperty("fareFamilyCode",a)+"-"+this.getJsonProperty("fareFamilyName",a):i.CABIN+this.getJsonProperty("segment.0.cabin",a)}return this.computeGenericProductCategory(h,c,g,u,n)},i.prototype.computeGenericProductCategory=function(t,e,r,n,i){return t+"/"+e+"/"+r+"/"+n+"/"+i},i.prototype.getAncillaryService=function(t){for(var e=0,r=this._data.product;e<r.length;e++){var n=r[e];if(n.productInfo.productID===t)return n.productInfo.productDetails.ancillaryService}return null},i.prototype.getInsurance=function(t){for(var e=0,r=this._data.product;e<r.length;e++){var n=r[e],i=this.getJsonObject("productInfo.productDetails.insurance",n);if(i&&n.productInfo.productID===t)return i}return null},i.prototype.getSearchInput=function(){return this._data.searchInput},i.prototype.getSearchInputFlightDetails=function(){return this.getJsonObject("searchInputInfo.flightDetails",this.getSearchInput())},i.prototype.computeFlightProduct=function(){if(this.hasProduct())for(var t=0,e=this._data.product;t<e.length;t++){var r=e[t],n=this.getJsonObject("productInfo.productDetails.flightTicket",r);if(n)return this.flightProduct=n,this.flightProduct}return null},i.prototype.getBoundIndex=function(t){for(var e=this.flightProduct,r=0;r<e.bound.length;r++){if(e.bound[r].boundID===parseInt(t,10))return r}return null},i.prototype.getProductRoute=function(){for(var t=[],e=0;e<this.getBoundCount();e++)t.push(this.getBoundRoute(e));return t.join("_")},i.prototype.getBoundRoute=function(t){var e=this.flightProduct.bound[t].segment;return this.getAirportsList(e).join("_")},i.prototype.getProductFlights=function(){for(var t=[],e=0;e<this.getBoundCount();e++)t.push(this.getBoundFlights(e));return t.join("|")},i.prototype.getBoundFlights=function(t){var r=this.flightProduct.bound[t],n=[];if(r.segment)for(var i=0,a=r.segment;i<a.length;i++){var o=a[i],s=o.marketingAirlineCode+o.marketingFlightNumber,c=e.getShortDayOfWeek(o.departure.dateTime);n.push(s+"_"+c)}return n.join("|")},i.prototype.getSegment=function(t,e){for(var r=0,n=this.flightProduct.bound;r<n.length;r++){var i=n[r];if(i.boundID===parseInt(t,10))for(var a=0,o=i.segment;a<o.length;a++){var s=o[a];if(s.segmentID===parseInt(e,10))return s}}return null},i.prototype.getBoundType=function(t,e){var r=e||this.flightProduct.bound[t].boundID,n=i.COMPLEX+r,a=this.getTripType();return a===i.TRIP_TYPE_ONEWAY?n=i.OUTBOUND:a===i.TRIP_TYPE_RETURN&&(n=0===t?i.OUTBOUND:i.INBOUND),n},i.prototype.getAirportsList=function(t){var e=[];if(t){for(var r=0,n=t;r<n.length;r++){var i=n[r];e.push(this.getJsonProperty("departure.airportCode",i))}e.push(this.getJsonProperty("arrival.airportCode",t[t.length-1]))}return e},i.prototype.getFullLocation=function(t){return t?this.getJsonProperty("cityCode",t)+"."+this.getJsonProperty("airportCode",t):i.NOT_SET_DATA},i.prototype.getPassengerFrequentFlyer=function(t){for(var e=0,r=this._data.traveller;e<r.length;e++){var n=r[e];if(n.travellerID===t){var i=this.getJsonProperty("loyaltyProgram.0.program",n),a=this.getJsonProperty("loyaltyProgram.0.number",n);return i&&a>0?n.travellerID+"."+i+".Member":n.travellerID+".NOT-FF"}}return null},i.prototype.getRouteType=function(t){var e=this.getSearchInputFlightDetails();if(!e)return i.NOT_SET_DATA;var r=this.getBoundsRouteType(t,e);return r===i.NOT_SET_DATA&&this.flightProduct.bound?this.getBoundsRouteType(t,this.flightProduct.bound):r},i.prototype.getBoundsRouteType=function(t,e){for(var r=0,n=e;r<n.length;r++){var a=n[r],o=this.getJsonObject("departure.countryCode",a),s=this.getJsonObject("arrival.countryCode",a);if(!o||!s)return i.NOT_SET_DATA;if(o!==t||s!==t)return i.INTERNATIONAL}return i.DOMESTIC},i.prototype.getDXFlightImpression=function(e,r,n,a,o){for(var s=[],c=[],g=0,u=e;g<u.length;g++){var h=u[g],d=new Date(h.beginDate);s.push(h.airline.code+h.flightNumber+"_"+t.getDay(d.getDay())),c.push(h.beginLocation.locationCode)}c.push(e[e.length-1].endLocation.locationCode);var p=s.join("|"),l=c.join("_"),f=new Date(e[0].beginDate),y=f.getFullYear()+(f.getMonth()<9?"0":"")+(f.getMonth()+1)+(f.getDate()<9?"0":"")+f.getDate(),v=e.length-1;return{id:this.computeFlightId(l,p,n),name:this.getProductName(),brand:i.FLIGHT_TYPE,category:this.computeGenericProductCategory(r,v,o,y,i.FLIGHT_TYPE),position:a++}},i.prototype.getJsonProperty=function(t,e){return void 0===e&&(e=this._data),r.getJsonProperty(t,e)},i.prototype.getJsonObject=function(t,e){return void 0===e&&(e=this._data),r.getJsonObject(t,e)},i.prototype.getJsonAmount=function(t,e){return void 0===e&&(e=this._data),r.getJsonAmount(t,e)},i.FLIGHT_TYPE="flight",i.FUELSURCHARGE_TYPE="fuelsurcharge",i.SERVICEFEES_TYPE="servicefees",i.TAX_TYPE="tax",i.USER_LOGGED="logged",i.USER_ANOM="anonymous",i.TRIP_TYPE_ONEWAY="OW",i.TRIP_TYPE_RETURN="RT",i.TRIP_TYPE_COMPLEX="CP",i.CABIN="Cabin",i.NOT_SET_DATA=r.NOT_SET_DATA,i.ANCILLARY_TYPE="ancillary",i.INSURANCE_TYPE="insurance",i.OUTBOUND="Outbound",i.INBOUND="Inbound",i.COMPLEX="Complex",i.ITINERARY="Itinerary",i.INTERNATIONAL="INTERNATIONAL",i.DOMESTIC="DOMESTIC",i.SEGMENT="Segment",i.BOUND="Bound",i.TRIP="Trip",i.TRAVELLER="Traveller",i.SHORT_HAUL="short-haul",i.MID_HAUL="mid-haul",i.LONG_HAUL="long-haul",i.FLOW_RETRIEVE="RETRIEVE",i.FLOW_REVENUE="REVENUE",i.FLOW_ATC="ATC",i}();!function(t){t[t.ERROR=0]="ERROR",t[t.WARN=1]="WARN",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.TRACE=4]="TRACE"}(a||(a={}));var s=function(){function t(){this.trace=a.TRACE<=t.level?console.trace.bind(window.console,"[TRACE] DigitalAnalytics: "):function(){},this.debug=a.INFO<=t.level?console.log.bind(window.console,"[INFO] DigitalAnalytics: "):function(){},this.info=a.DEBUG<=t.level?console.info.bind(window.console,"[DEBUG] DigitalAnalytics: "):function(){},this.warn=a.WARN<=t.level?console.warn.bind(window.console,"[WARN] DigitalAnalytics: "):function(){},this.error=a.ERROR<=t.level?console.error.bind(window.console,"[ERROR] DigitalAnalytics: "):function(){}}return t.level=a.ERROR,t}(),c=function(){function t(t,e){this.storage=t,this._conf=e,this._logger=new s,this._amountProducts=[o.FUELSURCHARGE_TYPE,o.SERVICEFEES_TYPE,o.TAX_TYPE],this.readyFail=!1}return t.prototype.consentUserRequired=function(){return this._conf.consentUserRequired},t.prototype.processViewedPages=function(){var t=this.storage.load(this.data.getSessionId());n.isFarePage(this.data.getPageID())&&(t.isFarePage=!0),this.pageFrom(n.FLIGHT_GROUP)&&(t.isFarePage=!1,t.selectedFlights=[null,null,null,null,null,null]),this.storage.save(this.data.getSessionId(),t)},t.prototype.getDataValue=function(t,e,r){try{return e.apply(this.data,r)}catch(n){this.processException("Error getting value for "+t,n)}return null},t.prototype.shouldTrackTransaction=function(t){for(var e=0,r=this.storage.load(this.data.getSessionId()).trackedTransactions;e<r.length;e++){if(r[e]===t)return this._logger.info("PNR "+t+" already sent to analytics."),!1}return!0},t.prototype.pageFromArray=function(t){for(var e=!1,r=0;r<t.length&&!e;r++){var i="undefined"!=typeof n[t[r]]?n[t[r]]:t[r];e=n.isFromGroup(this.data.getPageID(),i)}return e},t.prototype.pageFrom=function(t){return n.isFromGroup(this.data.getPageID(),t)},t.prototype.addTrackedTransaction=function(t){var e=this.storage.load(this.data.getSessionId());e.trackedTransactions.push(t),this.storage.save(this.data.getSessionId(),e)},t.prototype.getPersistedTransactionId=function(t){return t+"-"+this.data.getFlow()+"-"+this.data.getTransactionId()+"-"+this.data.getPayment()},t.prototype.getTrackerVarName=function(){return this._conf.trackerVar},t.prototype.getTrackerFn=function(){return window[this.getTrackerVarName()]},t.prototype.whenReady=function(e){var r=this,n=this.constructor.CODE+" provider: ";if(this.readyFail)this._logger.debug(n+"already failed previously. Not retrying");else if(void 0===this.getTrackerFn()){var i=0;this._logger.debug(n+"Waiting for tracker function ("+this.getTrackerVarName()+")...");var a=window.setInterval(function(){if(i>=t.READY_MAX_TRIES)return window.clearInterval(a),r._logger.error(n+"Stopped waiting after "+i+" tries for tracker function ("+r.getTrackerVarName()+")"),void(r.readyFail=!0);i++,void 0!==r.getTrackerFn()?(window.clearInterval(a),e()):r._logger.debug(n+"Waiting for tracker function ("+r.getTrackerVarName()+")...")},500)}else e()},t.prototype.processOverrides=function(){var e=this._conf.overrides,r=[];return Object.keys(e).forEach(function(n){var i=e[n];if(i.scope&&"hit"!==i.scope)"product"===i.scope?r[n]=i:this._logger.info("Wrong scope for  "+i);else if(!i.pageMatch||this.pageFromArray(i.pageMatch)){var a=i.func;"string"==typeof i.func&&(a=this.data[i.func]);var o=[];"undefined"!=typeof i.funcArgs&&Object.keys(i.funcArgs).forEach(function(e){var r=i.funcArgs[e];"string"==typeof r&&0===r.indexOf(t.PREFIXFUNCARG)?o.push(this[r.substr("provider.".length)]):"string"==typeof r?o.push(r):"function"==typeof r&&o.push(r())},this),this.setInTracker(n,a,o)}},this),r},t.prototype.isEventsAllowed=function(e){if("object"!=typeof this._conf[t.EVENT_OVERRIDES_KEY])return!0;var r=this._conf[t.EVENT_OVERRIDES_KEY];if("object"!=typeof r[t.EVENT_OVERRIDES_BLACKLIST_KEY])return!0;var n=!0;return r[t.EVENT_OVERRIDES_BLACKLIST_KEY].some(function(t){return"object"==typeof t.category&&"string"==typeof t.category.primaryCategory&&"object"==typeof t.eventInfo&&"string"==typeof t.eventInfo.componentID&&"string"==typeof t.eventInfo.eventName&&"string"==typeof t.eventInfo.key&&"string"==typeof t.eventInfo.pageID&&t.category.primaryCategory===e.category.primaryCategory&&t.eventInfo.componentID===e.eventInfo.componentID&&t.eventInfo.eventName===e.eventInfo.eventName&&t.eventInfo.key===e.eventInfo.key&&t.eventInfo.pageID===e.eventInfo.pageID&&(n=!1),!n},this),n},t.READY_MAX_TRIES=15,t.PREFIXFUNCARG="provider.",t.EVENT_OVERRIDES_KEY="events",t.EVENT_OVERRIDES_BLACKLIST_KEY="blacklist",t}(),g=function(){return function(){}}(),u=function(){function t(){this._logger=new s}return Object.defineProperty(t.prototype,"rate",{get:function(){return this._rate},enumerable:!0,configurable:!0}),t.prototype.useCurrency=function(e){return this._srcCurrency=e,t.UNSUPPORTED[e]?(this._destCurrency=t.UNSUPPORTED[e].target,this._rate=t.UNSUPPORTED[e].rate,this._logger.info(e+" is not supported by Universal. Using "+this._destCurrency+" with xchange rate "+this.rate)):(this._destCurrency=e,this._rate=1),this._destCurrency},t.prototype.convert=function(t){return t&&null!=t?r.roundAmount(t*this.rate):t},t.UNSUPPORTED={version:"2019.01.30",XPF:{rate:.00838,target:"EUR"},ISK:{rate:.007339,target:"EUR"},AFN:{rate:.011681,target:"EUR"},ALL:{rate:.008074,target:"EUR"},AMD:{rate:.001856,target:"EUR"},ANG:{rate:.489225,target:"EUR"},AOA:{rate:.002748,target:"EUR"},AWG:{rate:.486507,target:"EUR"},AZN:{rate:.514562,target:"EUR"},BAM:{rate:.511291,target:"EUR"},BBD:{rate:.437856,target:"EUR"},BDT:{rate:.010571,target:"EUR"},BHD:{rate:2.329024,target:"EUR"},BIF:{rate:496e-6,target:"EUR"},BMD:{rate:.875713,target:"EUR"},BND:{rate:.64732,target:"EUR"},BSD:{rate:.875713,target:"EUR"},BWP:{rate:.085644,target:"EUR"},BYN:{rate:.407497,target:"EUR"},BZD:{rate:.437856,target:"EUR"},CRC:{rate:.001426,target:"EUR"},CUP:{rate:.875713,target:"EUR"},CVE:{rate:.009069,target:"EUR"},DJF:{rate:.004927,target:"EUR"},DOP:{rate:.017503,target:"EUR"},DZD:{rate:.007416,target:"EUR"},ERN:{rate:.05838,target:"EUR"},ETB:{rate:.031196,target:"EUR"},FJD:{rate:.418431,target:"EUR"},FKP:{rate:1.153518,target:"EUR"},GEL:{rate:.331041,target:"EUR"},GHS:{rate:.17767,target:"EUR"},GIP:{rate:1.153518,target:"EUR"},GMD:{rate:.017782,target:"EUR"},GNF:{rate:96e-6,target:"EUR"},GTQ:{rate:.113179,target:"EUR"},GYD:{rate:.004161,target:"EUR"},HNL:{rate:.035983,target:"EUR"},HTG:{rate:.011241,target:"EUR"},IEP:{rate:.787564,target:"EUR"},IQD:{rate:742e-6,target:"EUR"},IRR:{rate:1e-5,target:"EUR"},JMD:{rate:.006519,target:"EUR"},JOD:{rate:1.235138,target:"EUR"},KES:{rate:.008761,target:"EUR"},KGS:{rate:.012549,target:"EUR"},KHR:{rate:221e-6,target:"EUR"},KMF:{rate:.002032,target:"EUR"},KPW:{rate:.008165,target:"EUR"},KWD:{rate:2.893674,target:"EUR"},KYD:{rate:1.067943,target:"EUR"},KZT:{rate:.002315,target:"EUR"},LAK:{rate:103e-6,target:"EUR"},LBP:{rate:58e-5,target:"EUR"},LKR:{rate:.004845,target:"EUR"},LRD:{rate:.005472,target:"EUR"},LSL:{rate:.064201,target:"EUR"},LYD:{rate:.640026,target:"EUR"},MDL:{rate:.051803,target:"EUR"},MGA:{rate:248e-6,target:"EUR"},MKD:{rate:.016286,target:"EUR"},MMK:{rate:579e-6,target:"EUR"},MNT:{rate:334e-6,target:"EUR"},MOP:{rate:.108364,target:"EUR"},MRO:{rate:.00244,target:"EUR"},MUR:{rate:.026271,target:"EUR"},MVR:{rate:.056813,target:"EUR"},MWK:{rate:.001219,target:"EUR"},MZN:{rate:.014227,target:"EUR"},NAD:{rate:.064201,target:"EUR"},NGN:{rate:.00243,target:"EUR"},NIO:{rate:.027201,target:"EUR"},NPR:{rate:.007776,target:"EUR"},OMR:{rate:2.279723,target:"EUR"},PAB:{rate:.875713,target:"EUR"},PGK:{rate:.265362,target:"EUR"},PYG:{rate:146e-6,target:"EUR"},QAR:{rate:.240481,target:"EUR"},RWF:{rate:.001004,target:"EUR"},SBD:{rate:.111202,target:"EUR"},SCR:{rate:.066257,target:"EUR"},SDG:{rate:.018344,target:"EUR"},SLL:{rate:102e-6,target:"EUR"},SOS:{rate:.001542,target:"EUR"},SRD:{rate:.118135,target:"EUR"},STD:{rate:4e-5,target:"EUR"},SVC:{rate:.100081,target:"EUR"},SYP:{rate:.002008,target:"EUR"},SZL:{rate:.064201,target:"EUR"},TMT:{rate:.250203,target:"EUR"},TND:{rate:.292647,target:"EUR"},TOP:{rate:.386968,target:"EUR"},TTD:{rate:.128914,target:"EUR"},TZS:{rate:379e-6,target:"EUR"},UGX:{rate:238e-6,target:"EUR"},UYU:{rate:.027031,target:"EUR"},UZS:{rate:105e-6,target:"EUR"},VES:{rate:265e-6,target:"EUR"},VUV:{rate:.007822,target:"EUR"},WST:{rate:.330913,target:"EUR"},XAF:{rate:.001524,target:"EUR"},XCD:{rate:.324338,target:"EUR"},XOF:{rate:.001524,target:"EUR"},YER:{rate:.003502,target:"EUR"},ZMW:{rate:.073357,target:"EUR"}},t}(),h=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.checkoutStepConf={ALPI:1,APIM:1,APIS:1,"ALPI-OWD":1,"ALPI-ITIN":1,"ALPI-SD":1,"ALPI-OWC":1,AAS:2,"AAAS-OWD":2,"AAAS-ITIN":2,"AAAS-SD":2,"AAAS-OWC":2,PURC:3,"PURC-OWD":3,"PURC-ITIN":3,"PURC-SD":3,VERI:4},e}return h(e,t),e.prototype.init=function(t,e,n,i){var a=this;return this._conf.checkoutFunnel&&(this.checkoutStepConf=this._conf.checkoutFunnel),this._logger.info("Universal config: ",this._conf),this._carrierCode=t,this._homeCountryCode=e,this._enableDebug=n,this.injectScript(),this.whenReady(function(){var t={name:a._conf.trackerName,siteSpeedSampleRate:a._conf.siteSpeedSampleRate,allowLinker:a._conf.allowLinker};if(r.isAppEmbedded()&&(t.storage="none",window.localStorage&&(t.clientId=window.localStorage.getItem("ga:clientId"))),a.getTrackerFn()("create",a._conf.trackingId,"auto",t),!0===a._conf.setBeacon&&a.setTrackerValue("transport","beacon"),r.isFileProtocol()&&a.setTrackerValue("checkProtocolTask",null),r.isAppEmbedded()&&(a.setTrackerValue("checkStorageTask",null),window.gaDigitalDataTrackerName=a._conf.trackerName,a.getTrackerFn()(function(){var t=window[window.GoogleAnalyticsObject].getByName(window.gaDigitalDataTrackerName).get("clientId");localStorage.setItem("ga:clientId",t)})),a._conf.anonymizeIp&&a.setTrackerValue("anonymizeIp",!0),a._conf.allowLinker){a._logger.info("Setting up autoLinker");var e=a._conf.linkedDomains?a._conf.linkedDomains:i;e&&e.length>0?(a.getTrackerFn()(a._conf.trackerName+".require","linker"),a.getTrackerFn()(a._conf.trackerName+".linker:autoLink",e),a._logger.debug("Universal: Setup autoLinker with "+e.length+" linked tracking domains: "+JSON.stringify(e))):a._logger.error("Universal: Could not setup autoLinker - no other tracking domain has been configured.")}a._logger.debug("Universal: Created tracker "+a._conf.trackingId+"(name="+a._conf.trackerName+", clientId="+t.clientId+") in variable window."+a.getTrackerVarName())}),!0},e.prototype.processEvent=function(t){var n=this;this.whenReady(function(){if(n.data||(n.data=new o(window.digitalData)),!r.isExternalAppWindow(n.data.getPagePath())){if(n._logger.debug("Universal: Checking if event "+t.category.primaryCategory+" is allowed: "+n.isEventsAllowed(t)),!n.isEventsAllowed(t))return;switch(t.category.primaryCategory){case"PageView":n.processPageView();break;case"ErrorRaised":case"Error":case"WidgetError":n.processError(t);break;case"WarningRaised":n.processWarning(t);break;default:if("Display"===t.category.primaryCategory&&"PageLoad"===t.eventInfo.eventName)break;n._logger.debug("Universal: Processing event"),n.sendProductClickEventHit(t);var i=o.getEventAttributeValue(t,e.PROMOCODE),a="";null!=i&&(a=e.PROMOCODE+"_"+i),"FlightUpsell"===t.eventInfo.eventName?n.processUpsellTeaser(t):n.getTrackerFn()(n._conf.trackerName+".send",{hitType:"event",eventCategory:t.category.primaryCategory,eventAction:t.eventInfo.eventName,eventLabel:i?a:t.eventInfo.eventName,eventValue:1,nonInteraction:!n.isInteractive(t),transport:"beacon"}),n._logger.debug("Universal: Event "+t.category.primaryCategory+" sent")}}})},e.prototype.processException=function(t,e){if(this._enableDebug&&this._conf.trackException){this._logger.error("Universal: Processing exception: "+t),this._logger.error(e);var r={exDescription:t+" : "+e.stack,exFatal:!0};if(window.location.href.indexOf("utm_source=selenium")>=0){var n=new URLSearchParams(window.location.search).get("utm_campaign");n&&n.length>0&&(r.exDescription="["+n+"] "+r.exDescription)}this.getTrackerFn()(this._conf.trackerName+".send","exception",r)}},e.prototype.getTrackerVarName=function(){return window.GoogleAnalyticsObject||this._conf.trackerVar},e.prototype.processPageView=function(){this._logger.debug("Universal: start processing pageview"),this.data=new o(window.digitalData),this._productCustData=this.processOverrides(),this.processViewedPages(),this.pageFrom(n.RETRIEVE_GROUP)||this.pageFrom(n.ATC_GROUP)||this.pageFrom(n.SERVICING_GROUP)||this.pageFrom(n.SSCI_GROUP)||"#/TLIST"===window.document.location.hash||"#/RTPL"===window.document.location.hash||this.processEcommerce(),this.getTrackerFn()(this._conf.trackerName+".send","pageview"),this._logger.info("Universal: Sent pageview hit to Universal"),this.setProductImpressions(),this.unSetMetricsAndDimensions(),this.sendAddToCartEventHit(),this.sendPaymentCheckoutOptionEventHit()},e.prototype.errorWarningMsgFromPlnext=function(t,e){var n=r.getJsonProperty("utils.pageProvider.PlnextPageProvider._pageDefinitionConfig.pageData.errorList.globalErrors",window.plnextv2);if(n){if("error"===t&&n.E)for(i=0;i<n.E.length;i++)if(n.E[i].code===e)return n.E[i].message;if("warning"===t&&n.W)for(var i=0;i<n.W.length;i++)if(n.W[i].code===e)return n.W[i].message}},e.prototype.processError=function(t){this._logger.debug("Universal: Processing error");if(o.getEventAttributeValue(t,"Warning"))this.processWarning(t);else{var e=o.getEventAttributeValue(t,"errorCode");e||(e=o.getEventAttributeValue(t,"WidgetError")),this.sendError("error",e,"",0)}},e.prototype.processWarning=function(t){this._logger.debug("Universal: Processing warning");var e=o.getEventAttributeValue(t,"Warning");this.sendError("warning",e,"",0)},e.prototype.processUpsellTeaser=function(t){this._logger.debug("Universal: Processing Upsell Teaser");var e="InitialFF_"+o.getEventAttributeValue(t,"InitialFF")+"|UpgradeFF_"+o.getEventAttributeValue(t,"UpgradeFF"),r="";"TeaserDisplayed"===t.eventInfo.key?r="Impression":"Upgrade"===t.eventInfo.key&&(r="Click");var n={eventCategory:"Upsell Teaser",eventAction:r,eventLabel:e,eventValue:1};this.getTrackerFn()(this._conf.trackerName+".send","event",n)},e.prototype.isInteractive=function(t){return t.category&&t.category.primaryCategory&&"UserEvent"===t.category.primaryCategory},e.prototype.unSetMetricsAndDimensions=function(){Object.keys(this._conf.overrides).forEach(function(t){t.match(new RegExp("(dimension|metric)"))&&this.unsetTracker(t)},this)},e.prototype.processEcommerce=function(){this._logger.debug("Enabling ecommerce module"),this.getTrackerFn()(this._conf.trackerName+".require","ec");var t=new u,e=this.data.getCurrency();if(e!==r.NOT_SET_DATA){var n=t.useCurrency(e);this.getTrackerFn()(this._conf.trackerName+".set","currencyCode",n),this._logger.debug("Universal: Setting ecommerce currency to :"+n+" - original currency: "+e)}else this._logger.warn("Universal: Unable to set currency - original currency detected to: "+e);this.addEcommerceProducts(),this.setCheckoutAction(),this.setPurchaseAction()},e.prototype.addProduct=function(t){var r=new g;r.id=t.productId,r.name=t.productName,r.category=t.productCategory,r.brand=t.parentproductType,r.variant=t.variant,r.price=t.price,r.quantity=t.quantity,Object.keys(this._productCustData).forEach(function(n){var i=this._productCustData[n],a=i.param,o=i.productMatch.indexOf(t.productType)>-1,s=!(i.pageMatch&&!this.pageFromArray(i.pageMatch));o&&s&&("string"==typeof a?0===a.indexOf(e.PREFIXDATA)?r[n]=this.data[a.substr(e.PREFIXDATA.length)]():r[n]=t[a]:"function"==typeof a&&(r[n]=a()))},this),this._logger.info("Universal: adding ec "+t.productType+" product:"),this._logger.info(r),this.getTrackerFn()(this._conf.trackerName+".ec:addProduct",r)},e.prototype.addEcommerceProducts=function(){var t=0;if(this.data.hasProduct()){var e=new u;e.useCurrency(this.data.getCurrency());var r=o.FLIGHT_TYPE,n=this.data.getProductName(),i=this.data.getPassengersList(),a=this.data.getFlightQuantity(),s=this.data.getAdvancedPurchaseDayBucket();if(this.data.isItineraryMode()){if(m=this.data.getItineraryId()){var c=this.data.getFlightCategory(null,this._homeCountryCode),h=this.data.getFlightDepartureLocation(0),d=this.data.getFlightArrivalLocation(),p=this.data.getItineraryPriceCategories(e.rate),l=this.data.getItineraryUpsell(),f=this.data.getItineraryVariant(),y=e.convert(this.data.getItineraryPricePerPax());this.addProduct({productId:m,productType:o.FLIGHT_TYPE,parentproductType:r,productName:n,productCategory:c,variant:f,price:y,quantity:a,departure:h,arrival:d,paxList:i,advancedPurchaseDayBucket:s,priceCategories:p,upsell:l}),t++}}else for(var v=0;v<this.data.getBoundCount();v++){var m=this.data.getFlightId(v);if(m){var c=this.data.getFlightCategory(v,this._homeCountryCode),h=this.data.getFlightDepartureLocation(v),d=this.data.getFlightArrivalLocation(v),p=this.data.getFlightPriceCategories(v,e.rate),l=this.data.getFlightUpsell(v),f=this.data.getFlightVariant(v),y=e.convert(this.data.getFlightPricePerPax(v));this.addProduct({productId:m,productType:o.FLIGHT_TYPE,parentproductType:r,productName:n,productCategory:c,variant:f,price:y,quantity:a,departure:h,arrival:d,paxList:i,advancedPurchaseDayBucket:s,priceCategories:p,upsell:l}),t++}}for(var P=this.data.getAncillaryServicesIds(),_=0;_<P.length;_++){var T=P[_],I=new g;I.id=this.data.getAncillaryServiceId(T),I.id&&(this.addProduct({productId:I.id,productType:"aas",parentproductType:r,productName:n,productCategory:this.data.getAncillaryServiceCategory(T,this._homeCountryCode),variant:this.data.getAncillaryVariant(T),price:e.convert(this.data.getAncillaryServicePricePerPax(T)),quantity:this.data.getAncillaryServiceQuantity(T),departure:this.data.getAncillaryServiceDepartureLocation(T),arrival:this.data.getAncillaryServiceArrivalLocation(T),paxList:i,advancedPurchaseDayBucket:s,priceCategories:null,upsell:null}),t++)}for(var E=this.data.getInsuranceIds(),_=0;_<E.length;_++){var A=E[_],C=new g;C.id=this.data.getInsuranceId(A),C.id&&(this.addProduct({productId:C.id,productType:"ins",parentproductType:r,productName:n,productCategory:this.data.getInsuranceCategory(this._homeCountryCode),variant:this.data.getInsuranceVariant(A),price:e.convert(this.data.getInsurancePrice(A)),quantity:1,departure:null,arrival:null,paxList:i,advancedPurchaseDayBucket:s,priceCategories:null,upsell:null}),t++)}for(var w=0,D=this._amountProducts;w<D.length;w++){var R=D[w],S=this.data.getPriceProductPrice(R);S>0&&(this.addProduct({productId:this.data.getPriceProductId(R),productType:"fuelSurchageServiceFeeTax",parentproductType:o.FLIGHT_TYPE,productName:n,productCategory:this.data.getPriceProductcategory(this._homeCountryCode,R),variant:this.data.getPriceProductVariant(R),price:e.convert(S),quantity:1,departure:null,arrival:null,paxList:i,advancedPurchaseDayBucket:s,priceCategories:null,upsell:null}),t++)}}return t},e.prototype.sendError=function(t,e,r,n){this._conf.usePlnextErrorWarning&&(r=this.errorWarningMsgFromPlnext(t,e));var i={eventCategory:t,eventAction:t+"_"+e,eventLabel:r,transport:"beacon"};this.getTrackerFn()(this._conf.trackerName+".send","event",i)},e.prototype.setProductImpressions=function(){if(this.pageFrom(n.AVAILABILITY_GROUP)){var t=this.getDataValue("impressionData",this.data.getImpressionData);if(t)for(var e=0,r=0,i=t;r<i.length;r++){var a=i[r];this.getTrackerFn()(this._conf.trackerName+".ec:addImpression",{id:a.id,name:a.name,brand:a.brand,category:a.category,variant:a.variant,position:a.position,list:this.getImpressionList()}),++e%20!=0&&e!==t.length||this.getTrackerFn()(this._conf.trackerName+".send","event",{hitType:"event",eventAction:"impressions",eventCategory:"impressions",nonInteraction:!0})}}},e.prototype.getImpressionList=function(){return"flights-"+this.getDataValue("addImpression:list:triptype",this.data.getTripType)+"-"+this.getDataValue("addImpression:list:locations",this.data.getSearchLocations).join("-")},e.prototype.sendProductClickEventHit=function(t){if("SelectFlight"===t.eventInfo.eventName){var e=this.getDataValue("click:flight",this.data.getSelectedFlight,[this.storage,this._homeCountryCode]);this._logger.info("Universal: clicking on ec flight product:"),this._logger.info(e),this.setProductDetailAction(t,e),this.getTrackerFn()(this._conf.trackerName+".ec:addProduct",e),this.getTrackerFn()(this._conf.trackerName+".ec:setAction","click",{list:this.getImpressionList()})}},e.prototype.setProductDetailAction=function(t,e){this.getTrackerFn()(this._conf.trackerName+".ec:addProduct",e),this.getTrackerFn()(this._conf.trackerName+".ec:setAction","detail"),this.getTrackerFn()(this._conf.trackerName+".send",{hitType:"event",eventCategory:t.category.primaryCategory,eventAction:t.eventInfo.eventName,eventLabel:t.eventInfo.eventName,eventValue:1,nonInteraction:!this.isInteractive(t),transport:"beacon"})},e.prototype.sendAddToCartEventHit=function(){var t=!1;if(n.isFarePage(this.data.getPageID())&&(t=!0),this.pageFrom(n.PAX_GROUP)){t=!this.storage.load(this.data.getSessionId()).isFarePage}if(t){this._logger.info("Universal: sending event to track add to cart");this.addEcommerceProducts()>0?(this.getTrackerFn()(this._conf.trackerName+".ec:setAction","add"),this.getTrackerFn()(this._conf.trackerName+".send","event",{hitType:"event",eventCategory:"UserEvent",eventAction:"AddFlightToCart",nonInteraction:!0})):this._logger.warn("Universal: The add to cart action was not sent because no products were gathered")}},e.prototype.setCheckoutAction=function(){var t,e=this.checkoutStepConf[this.data.getPageID()];e&&(t={step:e,option:null},this.getTrackerFn()(this._conf.trackerName+".ec:setAction","checkout",t),this._logger.info("Universal: setting checkout action on "+this.data.getPageID()+" - step : "+e))},e.prototype.sendPaymentCheckoutOptionEventHit=function(){if(this.pageFrom(n.CONFIRMATION_GROUP)){var t=this.getDataValue("checkout_option:payment",this.data.getPayment);t&&(this.getTrackerFn()(this._conf.trackerName+".ec:setAction","checkout_option",{step:this.checkoutStepConf.PURC,option:t}),this.getTrackerFn()(this._conf.trackerName+".send","event",{hitType:"event",eventCategory:"Checkout",eventAction:"Payment Option",nonInteraction:!0}),this._logger.info("Universal: sending event to track checkout_option (payment):"+t))}},e.prototype.setPurchaseAction=function(){if(this.pageFrom(n.CONFIRMATION_GROUP)&&this.shouldTrackTransaction(this.getPersistedTransactionId(this._conf.trackingId))||n.isredirectionPageSPBF(this.data.getPageID(),this.data.getChannel())){var t=new u;t.useCurrency(this.data.getCurrency());var e={id:this.data.getTransactionId(),revenue:t.convert(this.data.getTransactionRevenue()),tax:t.convert(this.data.getTransactionTax())};n.isredirectionPageSPBF(this.data.getPageID(),this.data.getChannel())&&(e.id=this.data.getTransactionId()+"_"+this.data.getPayment()),this.addTrackedTransaction(this.getPersistedTransactionId(this._conf.trackingId)),this.getTrackerFn()(this._conf.trackerName+".ec:setAction","purchase",e),this._logger.info("Universal: setting ec action to purchase with data : "),this._logger.info(e)}},e.prototype.injectScript=function(){if(!1!==this._conf.loadScript){if(window.GoogleAnalyticsObject)return this._conf.trackerVar=window.GoogleAnalyticsObject,void this._logger.info("Universal: Not loading analytics.js because there is already a GoogleAnalyticsObject in the window. Reusing it.");this._logger.info("Universal: Loading analytics.js as window."+this.getTrackerVarName()),function(t,e,r,n,i,a,o){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=(new Date).getTime(),a=e.createElement(r),o=e.getElementsByTagName(r)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(a,o)}(window,document,"script",0,this.getTrackerVarName())}else this._logger.info("Universal: Not loading analytics.js because the injection is deactivated in the config")},e.prototype.setInTracker=function(t,e,r){var n=this.getDataValue(t,e,r);this.setTrackerValue(t,n)},e.prototype.setTrackerValue=function(t,e){void 0!==e&&""!==e&&null!==e?(this._logger.info("Universal: Setting dimension "+t+" to "+e),this.getTrackerFn()(this._conf.trackerName+".set",t,e)):this._logger.debug("Universal: No value for dimension "+t)},e.prototype.unsetTracker=function(t){this._logger.info("Universal: Removing dimension "+t),this.getTrackerFn()(this._conf.trackerName+".set",t,null)},e.CODE="UA",e.PROMOCODE="PromotionCode",e.PREFIXDATA="data.",e}(c),p=function(){return function(){}}(),l=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.init=function(t,e,r,n){return this._logger.info("Baidu config: ",this._conf),this._carrierCode=t,this._homeCountryCode=e,this._enableDebug=r,this.injectScript(),!0},e.prototype.processEvent=function(t){var e=this;this.whenReady(function(){if(e.data||(e.data=new o(window.digitalData)),!r.isExternalAppWindow(e.data.getPagePath()))switch(t.category.primaryCategory){case"PageView":e.processPageView();break;case"ErrorRaised":case"Error":case"WidgetError":e.processError(t);break;case"WarningRaised":e.processWarning(t);break;default:e._logger.debug("baidu: Processing event"),e.getTrackerFn().push(["_trackEvent",t.category.primaryCategory,t.eventInfo.eventName,t.eventInfo.eventName,t.eventInfo.eventName]),e._logger.debug("baidu: Event "+t.category.primaryCategory+" sent")}})},e.prototype.processException=function(t,e){},e.prototype.processPageView=function(){this._logger.debug("Baidu: Processing pageview"),this.data=new o(window.digitalData),this.processEcommerce(this.data),this.getTrackerFn().push(["_trackPageview",this.data.getPagePath()+document.location.search]),this._logger.info("baidu: Sent pageview hit to Baidu")},e.prototype.processError=function(t){this._logger.debug("baidu: Processing error");if(o.getEventAttributeValue(t,"Warning"))this.processWarning(t);else{var e=o.getEventAttributeValue(t,"errorCode");if(!e)o.getEventAttributeValue(t,"WidgetError");this.sendError("error",e,"",0)}},e.prototype.processWarning=function(t){var e=o.getEventAttributeValue(t,"Warning");this.sendError("warning",e,"",0)},e.prototype.sendError=function(t,e,r,n){var i=["_trackEvent",t,t+"_"+e,r,n];this.getTrackerFn().push(i)},e.prototype.addFlightProduct=function(t,e,r,n,i,a){var o=new p;return o.skuId=t,o.skuName=e,o.category=r,o.Price=i,o.Quantity=a,o},e.prototype.processEcommerce=function(t){if(this._logger.debug("Enabling ecommerce module"),this.pageFrom(n.CONFIRMATION_GROUP)){var e={orderId:this.data.getTransactionId(),orderTotal:this.data.getTransactionRevenue(),item:[]},r=this.data.getProductName(),i=this.data.getFlightQuantity();if(this.data.isItineraryMode()){if(g=this.data.getItineraryId()){var a=this.data.getFlightCategory(null,this._homeCountryCode),o=this.data.getItineraryVariant(),s=this.data.getItineraryPricePerPax();e.item.push(this.addFlightProduct(g,r,a,o,s,i))}}else for(var c=0;c<this.data.getBoundCount();c++){var g=this.data.getFlightId(c);if(g){var a=this.data.getFlightCategory(c,this._homeCountryCode),o=this.data.getFlightVariant(c),s=this.data.getFlightPricePerPax(c);e.item.push(this.addFlightProduct(g,r,a,o,s,i))}}this.getTrackerFn().push(["_setCustomVar",1,"currencyCode",this.data.getCurrency()]),this.getTrackerFn().push(["_trackOrder",e]),this._logger.info("Baidu: purchase with data : ")}},e.prototype.injectScript=function(){var t=this._conf.trackingId;!1!==this._conf.loadScript?window._hmt?this._logger.info("Baidu: Not loading hm.js because there is already a _hmt in the window"):(window._hmt=[],this.getTrackerFn().push(["_setAccount",t]),this.getTrackerFn().push(["_setAutoPageview",!1]),this._logger.info("baidu: Loading hm.js as window."+this.getTrackerVarName()),function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?"+t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r)}()):this._logger.info("Baidu: Not loading hm.js because the injection is deactivated in the config")},e.CODE="BI",e}(c),y=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.init=function(t,e,r){return this._logger.info("Universal config: ",this._conf),this._homeCountryCode=e,window.nativeAppCommunication&&window.nativeAppCommunication.sendAnalyticsData?(this._logger.debug("FireBaseForApp: provider initialized"),!0):(this._logger.debug("FireBaseForApp: Failed to initialize provider. Missing window.nativeAppCommunication.sendAnalyticsData"),!1)},e.prototype.processEvent=function(t){if(this.data||(this.data=new o(window.digitalData)),!r.isExternalAppWindow(this.data.getPagePath()))switch(t.category.primaryCategory){case"PageView":this.processPageView()}},e.prototype.processException=function(t,e){},e.prototype.processPageView=function(){this._logger.debug("Universal: Processing pageview for firebase"),this.data=new o(window.digitalData),this._fireBaseData={},this.processPage(),this.pageFrom(n.CONFIRMATION_GROUP)&&this.shouldTrackTransaction(this.getPersistedTransactionId("merciApp"))&&(this.processEcommerce(),this.addTrackedTransaction(this.getPersistedTransactionId("merciApp"))),window.nativeAppCommunication.sendAnalyticsData(JSON.stringify(this._fireBaseData)),this._logger.info("Universal: Sent pageview hit and ecommerce to Firebase")},e.prototype.processPage=function(){this._fireBaseData.screenview={page_code:this.data.getPageID(),market:this.data.getMarket(),language:this.data.getLanguage()},this.processViewedPages()},e.prototype.addFlightProduct=function(t,e,r,n,i,a,o){this._fireBaseData.ecommerce_purchase.items.push({item_id:t,item_name:e,item_category:r,item_brand:n,item_variant:i,price:a,quantity:o})},e.prototype.processEcommerce=function(){this._logger.debug("Preparing ecommerce data for FireBase");var t=new u,e=t.useCurrency(this.data.getCurrency());this._logger.debug("Universal: Setting ecommerce FireBase currency to :"+e+" - original currency: "+this.data.getCurrency()),this._fireBaseData.ecommerce_purchase={currency:e,items:[]},this._fireBaseData.ecommerce_purchase.transaction_id=this.data.getTransactionId(),this._fireBaseData.ecommerce_purchase.value=String(t.convert(this.data.getTransactionRevenue())),this._fireBaseData.ecommerce_purchase.tax=String(t.convert(this.data.getTransactionTax()));var r=o.FLIGHT_TYPE,n=this.data.getProductName(),i=String(this.data.getFlightQuantity());if(this.data.isItineraryMode()){if(h=this.data.getItineraryId()){var a=this.data.getFlightCategory(null,this._homeCountryCode),s=String(t.convert(this.data.getItineraryPricePerPax())),c=this.data.getItineraryVariant();this.addFlightProduct(h,n,a,r,c,s,i)}}else for(var g=0;g<this.data.getBoundCount();g++){var h=this.data.getFlightId(g);if(h){var a=this.data.getFlightCategory(g,this._homeCountryCode),s=String(t.convert(this.data.getFlightPricePerPax(g))),c=this.data.getFlightVariant(g);this.addFlightProduct(h,n,a,r,c,s,i)}}for(var d=this.data.getAncillaryServicesIds(),p=0;p<d.length;p++){var l=d[p],f=this.data.getAncillaryServiceId(l);f&&this._fireBaseData.ecommerce_purchase.items.push({item_id:f,item_name:this.data.getProductName(),item_category:this.data.getAncillaryServiceCategory(l,this._homeCountryCode),item_brand:r,item_variant:this.data.getAncillaryVariant(l),price:String(t.convert(this.data.getAncillaryServicePricePerPax(l))),quantity:String(this.data.getAncillaryServiceQuantity(l))})}for(var y=this.data.getInsuranceIds(),p=0;p<y.length;p++){var v=y[p],m=this.data.getInsuranceId(v);m&&this._fireBaseData.ecommerce_purchase.items.push({item_id:m,item_name:this.data.getProductName(),item_category:this.data.getInsuranceCategory(this._homeCountryCode),item_brand:r,item_variant:this.data.getInsuranceVariant(v),price:String(t.convert(this.data.getInsurancePrice(v))),quantity:"1"})}for(var P=0,_=this._amountProducts;P<_.length;P++){var T=_[P],I=this.data.getPriceProductPrice(T);I>0&&this._fireBaseData.ecommerce_purchase.items.push({item_id:this.data.getPriceProductId(T),item_name:this.data.getProductName(),item_category:this.data.getPriceProductcategory(this._homeCountryCode,T),item_brand:o.FLIGHT_TYPE,item_variant:this.data.getPriceProductVariant(T),price:String(t.convert(I)),quantity:"1"})}},e.CODE="FFA",e}(c),m=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.init=function(t,e,r,n){return this._logger.info("Gtm config: ",this._conf),this._enableDebug=r,this.injectScript(),!0},e.prototype.processEvent=function(t){var e=this;this.whenReady(function(){if(e.data||(e.data=new o(window.digitalData)),!r.isExternalAppWindow(e.data.getPagePath())){e._logger.debug("Gtm: Processing event");var n="event";switch(t.category.primaryCategory){case"PageView":return e.processPageView();case"ErrorRaised":case"Error":case"WidgetError":case"WarningRaised":n=e.getErrorEventType(t);break;default:n=t.category.primaryCategory+"-"+t.eventInfo.eventName}e.getTrackerFn().push({"digitalData.event":t,event:"digitalData:"+n}),e._logger.debug("Gtm: Event "+n+" sent")}})},e.prototype.processException=function(t,e){},e.prototype.getErrorEventType=function(t){var e=o.getEventAttributeValue(t,"Warning");if(e)return"Warning-"+e;var r=o.getEventAttributeValue(t,"errorCode");return r||(r=o.getEventAttributeValue(t,"WidgetError")),r?"Error-"+e:t.category.primaryCategory},e.prototype.processPageView=function(){this._logger.debug("Gtm: Processing pageview"),this.data=new o(window.digitalData),this.getTrackerFn().push({"digitalData.digitalTouchpoint":this.data.getDigitalTouchpointObject(),"digitalData.page":this.data.getPageObject(),"digitalData.event":{},event:"digitalData:pageview"}),this._logger.info("Gtm: Sent pageview hit "+this.data.getPagePath()+document.location.search)},e.prototype.injectScript=function(){if(!1!==this._conf.loadScript){var t=this._conf.trackingId,e=this.getTrackerVarName();this._logger.info("Gtm: Loading gtm.js as window."+e+" with "+t),function(t,r,n,i,a){t[i]=t[i]||[],t[i].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var o=r.getElementsByTagName(n)[0],s=r.createElement(n),c=i!==e?"&l="+i:"";s.async=!0,s.src="https://www.googletagmanager.com/gtm.js?id="+a+c,o.parentNode.insertBefore(s,o)}(window,document,"script",e,t)}else this._logger.info("Gtm: Not loading gtm.js because the injection is deactivated in the config")},e.CODE="GTM",e}(c),_=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),T=window&&window.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _(e,t),e.prototype.init=function(t,e,r,n){return this._logger.info("Tealium config: ",this._conf),this.injectScript(),!0},e.prototype.processEvent=function(t){var e=this;this.whenReady(function(){if(e.data||(e.data=new o(window.digitalData)),!r.isExternalAppWindow(e.data.getPagePath()))switch(t.category.primaryCategory){case"WarningRaised":case"ErrorRaised":case"Error":e.sendEvent(t);break;case"UserEvent":e.data=e.data?e.data:new o(window.digitalData),t.eventInfo&&"FlightUpsell"===t.eventInfo.eventName&&"IRELAND"===e.data.getMarket()?e.sendEvent(t):e._logger.debug("Tealium: event ignored : "+t.category.primaryCategory+"/"+t.eventInfo.eventName);break;default:e._logger.debug("Tealium: event ignored : "+t.category.primaryCategory+"/"+t.eventInfo.eventName)}})},e.prototype.sendEvent=function(t){this.getTrackerFn().link(T({tealium_event:t.category.primaryCategory},r.flatten({event:t}))),this._logger.debug("Tealium: Event "+t.category.primaryCategory+"/"+t.eventInfo.eventName+" sent")},e.prototype.processException=function(t,e){},e.prototype.injectScript=function(){var t=this._conf.accountId,e=this._conf.profile,r=this._conf.env;!1!==this._conf.loadScript?window.utag?this._logger.info("Tealium: Not loading utag.js because there is already a window.utag object"):(this._logger.info("Tealium: Loading uatg.js as window."+this.getTrackerVarName()),function(n,i,a,o){n="//tags.tiqcdn.com/utag/"+t+"/"+e+"/"+r+"/utag.js",a="script",(o=(i=document).createElement(a)).src=n,o.type="text/java"+a,o.async=!0,(n=i.getElementsByTagName(a)[0]).parentNode.insertBefore(o,n)}()):this._logger.info("Tealium: Not loading utag.js because the injection is deactivated in the config")},e.CODE="UT",e}(c),E=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return E(e,t),e.prototype.init=function(t,e,r,n){return!this._conf.activationParameter||window.plnextv2&&window.plnextv2.utils&&window.plnextv2.utils.ImplementationUtils&&window.plnextv2.utils.ImplementationUtils.getBasefacts()["request."+this._conf.activationParameter]?(this._logger.info("Monetate config: ",this._conf),this.injectScript(),!0):(this._logger.debug("Monetate - provider not loaded as parameter "+this._conf.activationParameter+" is not sent"),!1)},e.prototype.processEvent=function(t){"PageView"===t.category.primaryCategory&&this.processPageView()},e.prototype.processException=function(t,e){},e.prototype.processPageView=function(){this._logger.debug("Monetate: start processing pageview"),this.data=new o(window.digitalData);try{this.prepareMonetatePageType(),this.prepareMonetateCustomVariables();var t=this.data.getPageID();n.isFromGroup(t,n.AVAILABILITY_GROUP)&&this.prepaMonetateFlightSearch(),n.isFromGroup(t,n.PAX_GROUP)&&this.prepaMonetateFlightMethodAPI("addFlightReview"),n.isFromGroup(t,n.CONFIRMATION_GROUP)&&this.prepaMonetateFlightMethodAPI("addFlightBooking"),this.getTrackerFn().push(["trackData"]),this._logger.debug("Monetate trackData pushed. "+this.getTrackerVarName()+"=",this.getTrackerFn())}catch(e){this._logger.error("Monetate: exception processing PageView",e)}},e.prototype.prepareMonetatePageType=function(){var t=this.data.getPageName(),e=t||this.data.getPageID();e=e.replace(/\s+/g,""),this.getTrackerFn().push(["setPageType",e])},e.prototype.prepareMonetateCustomVariables=function(){var t=[],e=this._conf.customVariables;e.includes("userIsLoggedIn")&&t.push({name:"userIsLoggedIn",value:this.data.getProfile()===o.USER_LOGGED}),e.includes("bookingFlowName")&&t.push({name:"bookingFlowName",value:this.data.getBookingFlow()}),e.includes("market")&&t.push({name:"market",value:this.data.getMarket()}),e.includes("formOfPayment")&&n.isFromGroup(this.data.getPageID(),n.CONFIRMATION_GROUP)&&t.push({name:"formOfPayment",value:this.data.getPayment()}),t.length>0&&this.getTrackerFn().push(["setCustomVariables",t])},e.prototype.prepaMonetateFlightSearch=function(){this.data.getTripType();this.data.isItineraryMode()?this._logger.warn("Monetate - not handling addFlightSearch for Itinerary mode"):this.getTrackerFn().push(["addFlightSearch",this.buildSearchObject()])},e.prototype.buildSearchObject=function(){var t=this.data.getTripType(),e=this.data.getSearchLocations(),r=this.data.getSearchDates(),n={depDate:r,destination:e.filter(function(t,e){return e%2!=0}),origin:e.filter(function(t,e){return e%2==0}),travelers:new Array(this.data.getFlightQuantity().toString())};return t===o.TRIP_TYPE_RETURN&&(n.depDate=new Array(r[0]),n.retDate=new Array(r[1])),n},e.prototype.prepaMonetateFlightMethodAPI=function(t){if(this.data.isItineraryMode())this._logger.warn("Monetate - not handling addFlightSearch for Itinerary mode");else if(this.data.hasProduct()){var e=this.buildSearchObject();e.serviceClass=new Array;for(var n=0;n<this.data.getBoundCount();n++){var i=this.data.flightProduct.bound[n],a=i.fareFamilyCode?i.fareFamilyCode:o.CABIN+r.getJsonProperty("segment.0.cabin",i);e.serviceClass.push(a)}var s=[t,e,this.data.getProductName(),1,this.data.getCartRevenue().toString(),this.data.getCurrency()];"addFlightBooking"===t&&s.splice(2,0,this.data.getTransactionId()),this.getTrackerFn().push(s)}else this._logger.warn("Monetate - Product data missing in digitalData - aborting")},e.prototype.injectScript=function(){if(window[this.getTrackerVarName()])this._logger.debug("Monetate: Not loading js script because there is already a "+this.getTrackerVarName()+" in window. Reusing it.");else{window.monetateT=(new Date).getTime(),this._logger.debug("Monetate: Loading JS script");var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=this._conf.scriptURL;var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e),window[this.getTrackerVarName()]=window[this.getTrackerVarName()]||[],this._logger.debug("[AB Testing] Monetate tag added")}},e.CODE="MO",e}(c),C=function(){return function(){this.providerCode="UA",this.consentUserRequired=!1,this.trackingId=null,this.trackerName="gaDigitalData",this.trackerVar="ga",this.loadScript=!0,this.allowLinker=!1,this.anonymizeIp=!1,this.setBeacon=!0,this.usePlnextErrorWarning=!1,this.trackException=!0,this.overrides={dimension1:{param:"departure",productMatch:["flight","aas"],scope:"product"},dimension2:{param:"arrival",productMatch:["flight","aas"],scope:"product"},dimension3:{param:"paxList",productMatch:["flight","aas","ins","fuelSurchageServiceFeeTax"],scope:"product"},dimension4:{param:"advancedPurchaseDayBucket",productMatch:["flight","aas","ins","fuelSurchageServiceFeeTax"],scope:"product"},dimension5:{func:"getLastSearch",funcArgs:["provider.storage"],pageMatch:["CONFIRMATION_GROUP"]},dimension6:{func:"getTravelGroup"},dimension7:{func:"getTrip",pageMatch:["FLIGHT_GROUP","CONFIRMATION_GROUP"]},dimension8:{func:"getPayment",pageMatch:["CONFIRMATION_GROUP"]},dimension9:{func:"getPageStructure",funcArgs:["provider._carrierCode"]},dimension10:{func:"getSearch",funcArgs:["provider.storage"],pageMatch:["FLIGHT_GROUP"]},dimension11:{func:"getLibVersionWithSessionId"},dimension12:{func:"getProfile"},dimension13:{func:"getTripRouteHaul",pageMatch:["PAX_GROUP"]},dimension14:{func:"getAward",pageMatch:["CONFIRMATION_GROUP"]},dimension15:{param:"priceCategories",productMatch:["flight"],scope:"product"},metric2:{param:"upsell",productMatch:["flight"],scope:"product"},metric3:{param:"quantity",productMatch:["flight"],scope:"product"},metric4:{func:"getTravellers"},metric5:{func:"getJourneyLength"},metric6:{func:"getAdvancedPurchase"},metric7:{func:"getAwardRevenue",pageMatch:["CONFIRMATION_GROUP"]},metric9:{func:"getRetrieveMetric",pageMatch:["RETRIEVE_GROUP"]},contentGroup1:{func:"getChannel"},contentGroup2:{func:"getMarketLanguage"},contentGroup3:{func:"getFlow"},userId:{func:"getUserID"},page:{func:"getPagePath"},customTask:{func:function(){return function(t){if("timing"===t.get("hitType")){for(var e={},r=1;201!==r;r++)e["dimension"+r]=undefined,e["metric"+r]=undefined;t.set(e)}}}}},this.events={blacklist:[]}}}(),w=function(){return function(){this.providerCode="BI",this.consentUserRequired=!1,this.trackingId=null,this.trackerVar="_hmt",this.loadScript=!0}}(),D=function(){return function(){this.providerCode="FFA",this.consentUserRequired=!1}}(),R=function(){return function(){this.providerCode="GTM",this.consentUserRequired=!1,this.trackingId=null,this.trackerVar="dataLayer",this.loadScript=!1}}(),S=function(){return function(){this.providerCode="UT",this.consentUserRequired=!1,this.accountId=null,this.profile="main",this.env="dev",this.trackerVar="utag",this.loadScript=!0}}(),F=function(){return function(){this.providerCode="MO",this.consentUserRequired=!1,this.activationParameter="AB_SOLUTION",this.scriptURL=null,this.trackerVar="monetateQ",this.customVariables=["userIsLoggedIn","bookingFlowName","market","formOfPayment"]}}();!function(){if("undefined"!=typeof window)try{var t=new window.CustomEvent("test",{cancelable:!0});if(t.preventDefault(),!0!==t.defaultPrevented)throw new Error("Could not prevent default")}catch(r){var e=function(t,e){var r,n;return e=e||{},e.bubbles=!!e.bubbles,e.cancelable=!!e.cancelable,(r=document.createEvent("CustomEvent")).initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n=r.preventDefault,r.preventDefault=function(){n.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(e){this.defaultPrevented=!0}},r};e.prototype=window.Event.prototype,window.CustomEvent=e}}();var O=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return O(e,t),e.prototype.init=function(t,e,r,n){return this._logger.info("Launch config: ",this._conf),this._enableDebug=r,this.injectScript(),!0},e.prototype.processEvent=function(t){var n=this;this.whenReady(function(){if(n.data||(n.data=new o(window.digitalData)),!r.isExternalAppWindow(n.data.getPagePath())){n._logger.debug("Launch: Processing event");var i="event";switch(t.category.primaryCategory){case"PageView":return n.processPageView();case"ErrorRaised":case"Error":case"WidgetError":case"WarningRaised":i=n.getErrorEventType(t);break;default:i=t.category.primaryCategory+"-"+t.eventInfo.eventName}var a=void 0;switch(a={"digitalData.digitalTouchpoint":n.data.getDigitalTouchpointObject(),"digitalData.page":n.data.getPageObject(),"digitalData.event":{},event:"digitalData:"+t.category.primaryCategory},n._conf.callType){case e.CALLTYPECUSTOMEVENT:n.latestCustomEvent=new CustomEvent(t.category.primaryCategory,{detail:a}),n._logger.info(n.latestCustomEvent),document.querySelector("body").dispatchEvent(n.latestCustomEvent);break;case e.CALLTYPEDIRECT:window._satellite.track(t.category.primaryCategory,a)}n._logger.debug("Launch: Event "+i+" sent")}})},e.prototype.processException=function(t,e){},e.prototype.getErrorEventType=function(t){var e=o.getEventAttributeValue(t,"Warning");if(e)return"Warning-"+e;var r=o.getEventAttributeValue(t,"errorCode");return r||(r=o.getEventAttributeValue(t,"WidgetError")),r?"Error-"+e:t.category.primaryCategory},e.prototype.processPageView=function(){this._logger.debug("Launch: Processing pageview"),this.data=new o(window.digitalData);var t;switch(t={"digitalData.digitalTouchpoint":this.data.getDigitalTouchpointObject(),"digitalData.page":this.data.getPageObject(),"digitalData.event":{},event:"digitalData:pageview"},this._conf.callType){case e.CALLTYPECUSTOMEVENT:this.latestCustomEvent=new CustomEvent("PageView",{detail:t}),this._logger.info(this.latestCustomEvent),document.querySelector("body").dispatchEvent(this.latestCustomEvent);break;case e.CALLTYPEDIRECT:window._satellite.track("PageView",t)}this._logger.info("Launch: Sent pageview hit "+this.data.getPagePath()+document.location.search)},e.prototype.injectScript=function(){if(!1!==this._conf.loadScript){var t=this._conf.trackingUrl;this._logger.info("launch: Loading _satellite JS with "+t),function(e,r,n){var i=e.getElementsByTagName(r)[0],a=e.createElement(r);a.async=!0,a.src=t,i.parentNode.insertBefore(a,i)}(document,"script")}else this._logger.info("Launch: Not loading because the injection is deactivated in the config")},e.CODE="AL",e.CALLTYPECUSTOMEVENT="CustomEvent",e.CALLTYPEDIRECT="Direct",e}(c),N=function(){return function(){this.providerCode="AL",this.consentUserRequired=!1,this.trackingUrl=null,this.trackerVar="_satellite",this.loadScript=!1}}(),U=function(){function t(){}return t.getProvider=function(t,e,n){switch(e){case d.CODE:return new d(t,r.extend(new C,n));case f.CODE:return new f(t,r.extend(new w,n));case v.CODE:return new v(t,r.extend(new D,n));case P.CODE:return new P(t,r.extend(new R,n));case I.CODE:return new I(t,r.extend(new S,n));case A.CODE:return new A(t,r.extend(new F,n));case b.CODE:return new b(t,r.extend(new N,n));default:return null}},t}(),k=function(){function t(){}return t.filterDigitalData=function(){var e=window.digitalData;try{if(void 0===e)throw new Error("Digital data is not set - unable to filter for dataLake");for(var n=t.getDataToKeep(e.version),i=t.filterData(e,n),a=0,o=i.user;a<o.length;a++){var s=o[a];if(s.profile)for(var c=0,g=s.profile;c<g.length;c++){var u=g[c];u.profileInfo&&u.profileInfo.internetProtocolAddress&&delete u.profileInfo.internetProtocolAddress}}if(i.event)for(var h=i.event.length-2;h>-1;h--){if("Continue"===i.event[h].eventInfo.eventName){i.event=i.event.slice(h+1);break}}for(var d=[],p=0,l=e.product;p<l.length;p++){var f=l[p],y=r.getJsonObject("productInfo.productDetails.flightTicket.bound",f);if(y)for(var v=!0,m=void 0,P=0,_=y;P<_.length;P++){var T=_[P];T.upsell&&(v&&(m={productInfo:{productDetails:{flightTicket:{bound:[]}}}},d.push(m),v=!1),m.productInfo.productDetails.flightTicket.bound.push({upsell:T.upsell}))}}return d.length>0&&(i.product=d),i}catch(I){}},t.filterData=function(t,e){for(var n={},i=0,a=e;i<a.length;i++){for(var o=a[i],s=n,c=o.split("."),g=0,u=c.slice(0,-1);g<u.length;g++){var h=u[g];s[h]||(s[h]={}),s=s[h]}s[c[c.length-1]]=r.getJsonObject(o,t)}return n},t.getDataToKeep=function(e){var r=e.split("."),n=r[0],i=r[1],a=t.keptDataPathPerDigitalDataVersion[n+"."+i];if(a)return a;var o=t.keptDataPathPerDigitalDataVersion[n+".*"];return o||t.keptDataPathPerDigitalDataVersion[t.keptDataPathDefaultValue]},t.keptDataPathPerDigitalDataVersion={"2.*":["version","pageInstanceID","digitalTouchpoint.category","digitalTouchpoint.touchpointInfo.bookingFlow","event","page","user"],"1.*":["version","pageInstanceID","context.bookingFlow","event","page","user"]},t.keptDataPathDefaultValue="2.*",t}(),L=function(){return function(t,e){this.callback=t,this.context=e}}(),V=function(){function t(){this._logger=new s}return t.prototype.init=function(t){var e=this;if(!t)throw new Error("EventQueue initialised without queue array.");this._eventSubscriptions=[],this._events=t;var r=this._events.push;this._events.push=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var i=r.apply(e._events,t),a=0,o=t;a<o.length;a++){var s=o[a];e.triggerEvent(s)}return i}},t.prototype.subscribe=function(t,e){this._eventSubscriptions.push(new L(t,e))},t.prototype.triggerEvent=function(t){if(t.eventInfo)for(var e=0,r=this._eventSubscriptions;e<r.length;e++){var n=r[e];n.callback.call(n.context,t)}else this._logger.warn("Ignoring event without event info")},t}(),M=function(){function t(){}return t.isSessionStorageOK=function(){try{return sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),!0}catch(t){return!1}},t.prototype.save=function(e,r){var n=this.getKeyName(e),i=JSON.stringify(r);if(t.useSessionStorage)sessionStorage.setItem(n,i);else{var a=window.location.hostname,o=encodeURIComponent(n)+"="+encodeURIComponent(i)+"; domain="+a+"; path=/";window.document.cookie=o}},t.prototype.load=function(e){var r,n=this.getKeyName(e);if(t.useSessionStorage)r=sessionStorage.getItem(n);else{var i=window.document.cookie.match(new RegExp("(^|;)\\s*"+encodeURIComponent(n)+"=([^;\\s]*)"));i&&(r=decodeURIComponent(i[2]))}var a={lastSearch:null,isFarePage:!1,trackedTransactions:[],selectedFlights:[null,null,null,null,null,null]};return r&&(a=JSON.parse(r)),a},t.prototype.getKeyName=function(t){return"DigitalAnalytics."+(t.length>10?t.substring(0,10):t)},t.useSessionStorage=t.isSessionStorageOK(),t}();return function(){function t(){this.providers=[],this.disabledProviders=[],this._logger=new s}return t.filterDigitalData=function(){return k.filterDigitalData()},t.expose=function(){var t=new o(window.digitalData);return{page:t.getPagePath(),title:document.title,host:document.location.host,clientid:function(){var t=window[window.GoogleAnalyticsObject],e=[];if(t!==undefined&&"function"==typeof t.getAll)for(var r=t.getAll(),n=r.length-1;n>=0;n--)e.push({name:r[n].get("name"),id:r[n].get("clientId")});return e}(),userid:t.getUserID()}},t.prototype.init=function(t,e){void 0===e&&(e=!1);try{if(this.conf=this.getActiveEnvironment(t.envs),this.conf.enableDebug="boolean"==typeof this.conf.enableDebug?this.conf.enableDebug:"SA"===this.conf.code,s.level="number"==typeof this.conf.logLevel?this.conf.logLevel:"SA"===this.conf.code?a.TRACE:a.WARN,"undefined"==typeof window.digitalData)throw new Error("Digital data is not set - no analytics processed");if(this.carrierCode=t.carrierCode,null===this.carrierCode)throw new Error("The airline code is not set. Please set it in the configuration.");if(this.homeCountryCode=t.homeCountryCode,!this.homeCountryCode||2!==this.homeCountryCode.length)throw new Error("The airline's home country code is not set. Please set it in the configuration.");this.initProviders(),this.bindEvents(e)}catch(i){this._logger.error(i);for(var r=0,n=this.providers;r<n.length;r++){n[r].processException("Error in DigitalAnalytics.init",i)}}},t.prototype.processEvent=function(t){try{for(var e=0,r=this.providers;e<r.length;e++){(a=r[e]).processEvent(t)}}catch(o){this._logger.error(o);for(var n=0,i=this.providers;n<i.length;n++){var a=i[n];a.processException("Error in DigitalAnalytics.processEvent",o)}}},t.prototype.getActiveEnvironment=function(t){var e="";if(void 0!==t){window.location&&window.location.hostname&&window.location.hostname.length>0?e=window.location.hostname.toLowerCase():window.appHostName&&window.appHostName.length>0&&(e=window.appHostName.toLowerCase());for(var r=0,n=t;r<n.length;r++)for(var i=n[r],a=0,o=i.domains;a<o.length;a++){var s=o[a];if(e.match(new RegExp(s.toLowerCase())))return this._logger.info("Activating RegEx config for environment "+i.code+" - domain: "+s),i}}throw new Error("No environment configuration found for host "+e)},t.prototype.bindEvents=function(t){this.eventBus=new V;var e=window.digitalData.event;if(this.eventBus.init(e),this.eventBus.subscribe(this.processEvent,this),t&&e)for(var r=0,n=e;r<n.length;r++){var i=n[r];this.eventBus.triggerEvent(i)}},t.prototype.initProviders=function(){var t=new M;this.providers=[];for(var e=0,r=this.conf.providers;e<r.length;e++){var n=r[e];this._logger.debug("Initializing analytics provider "+n.providerCode);var i=U.getProvider(t,n.providerCode,n),a=i._conf;"UA"===a.providerCode&&(a.siteSpeedSampleRate="number"==typeof a.siteSpeedSampleRate?a.siteSpeedSampleRate:"SA"===this.conf.code?0:10),i?!i.consentUserRequired()||this.retrieveUserConsent()?i.init(this.carrierCode,this.homeCountryCode,this.conf.enableDebug,this.conf.linkedDomains)&&this.providers.push(i):this.disabledProviders.push(i):this._logger.error("Unable to create provider for this config:",n)}0===this.providers.length&&this._logger.warn("No analytics providers initialized")},t.prototype.retrieveUserConsent=function(){return!!window.tempDigitalLibUserConsent},t.prototype.checkForUserConsent=function(){this.retrieveUserConsent()&&(this.providers=this.providers.concat(this.disabledProviders),this.disabledProviders=null)},t}()});